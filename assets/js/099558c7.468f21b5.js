"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[465],{7738:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"extensions/settings-and-config/implementing-settings","title":"Creating custom settings for WooCommerce extensions","description":"If you\'re customizing WooCommerce or adding your own functionality to it you\'ll probably need a settings page of some sort. One of the easiest ways to create a settings page is by taking advantage of the WCIntegration class. Using the Integration class will automatically create a new settings page under WooCommerce > Settings > Integrations and it will automatically save, and sanitize your data for you. We\'ve created this tutorial so you can see how to create a new integration.","source":"@site/../extensions/settings-and-config/implementing-settings.md","sourceDirName":"extensions/settings-and-config","slug":"/extensions/settings-and-config/implementing-settings","permalink":"/docs/extensions/settings-and-config/implementing-settings","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../extensions/settings-and-config/implementing-settings.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"post_title":"Creating custom settings for WooCommerce extensions","sidebar_label":"Creating custom settings","sidebar_position":1},"sidebar":"extensionsSidebar","previous":{"title":"Settings and config","permalink":"/docs/category/settings-and-config"},"next":{"title":"Add a section to a settings tab","permalink":"/docs/extensions/settings-and-config/adding-a-section-to-a-settings-tab"}}');var o=n(4848),s=n(8453);const a={post_title:"Creating custom settings for WooCommerce extensions",sidebar_label:"Creating custom settings",sidebar_position:1},r="Creating custom settings for WooCommerce extensions",l={},c=[{value:"Setting up the Integration",id:"setting-up-the-integration",level:2},{value:"Creating the Main Plugin File",id:"creating-the-main-plugin-file",level:3},{value:"Creating the Integration Class",id:"creating-the-integration-class",level:3},{value:"Creating Settings",id:"creating-settings",level:2},{value:"Types of Settings",id:"types-of-settings",level:3},{value:"Creating Your Own Settings",id:"creating-your-own-settings",level:3},{value:"Validating &amp; Sanitizing Data",id:"validating--sanitizing-data",level:2},{value:"Sanitize",id:"sanitize",level:3},{value:"Validation",id:"validation",level:3},{value:"A complete example",id:"a-complete-example",level:2}];function d(e){const t={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"creating-custom-settings-for-woocommerce-extensions",children:"Creating custom settings for WooCommerce extensions"})}),"\n",(0,o.jsxs)(t.p,{children:["If you're customizing WooCommerce or adding your own functionality to it you'll probably need a settings page of some sort. One of the easiest ways to create a settings page is by taking advantage of the ",(0,o.jsxs)(t.a,{href:"https://woocommerce.github.io/code-reference/classes/WC-Integration.html",title:"WC_Integration Class",children:[(0,o.jsx)(t.code,{children:"WC_Integration"})," class"]}),". Using the Integration class will automatically create a new settings page under ",(0,o.jsx)(t.strong,{children:"WooCommerce > Settings > Integrations"})," and it will automatically save, and sanitize your data for you. We've created this tutorial so you can see how to create a new integration."]}),"\n",(0,o.jsx)(t.h2,{id:"setting-up-the-integration",children:"Setting up the Integration"}),"\n",(0,o.jsx)(t.p,{children:"You'll need at least two files to create an integration so you'll need to create a directory."}),"\n",(0,o.jsx)(t.h3,{id:"creating-the-main-plugin-file",children:"Creating the Main Plugin File"}),"\n",(0,o.jsxs)(t.p,{children:["Create your main plugin file to ",(0,o.jsx)(t.a,{href:"https://developer.wordpress.org/reference/functions/add_action/",title:"WordPress add_action()",children:"hook"})," into the ",(0,o.jsx)(t.code,{children:"plugins_loaded"})," hook and check if the ",(0,o.jsx)(t.code,{children:"WC_Integration"})," ",(0,o.jsx)(t.a,{href:"https://www.php.net/manual/en/language.oop5.basic.php#language.oop5.basic.extends",title:"PHP Class Exists",children:"class exists"}),". If it doesn't then the user most likely doesn't have WooCommerce activated. After you do that you need to register the integration. Load the integration file (we'll get to this file in a minute). Use the ",(0,o.jsx)(t.code,{children:"woocommerce_integrations"})," filter to add a new integration to the ",(0,o.jsx)(t.a,{href:"http://php.net/manual/en/language.types.array.php",title:"PHP Array",children:"array"}),"."]}),"\n",(0,o.jsx)(t.h3,{id:"creating-the-integration-class",children:"Creating the Integration Class"}),"\n",(0,o.jsxs)(t.p,{children:["Now that we have the framework setup let's actually implement this Integration class. There already is a ",(0,o.jsx)(t.code,{children:"WC_Integration"})," class so we want to make a ",(0,o.jsx)(t.a,{href:"https://www.php.net/manual/en/language.oop5.inheritance.php",children:"child class"}),". This way it inherits all of the existing methods and data. You'll need to set an id, a description, and a title for your integration. These will show up on the integration page. You'll also need to load the settings by calling: ",(0,o.jsx)(t.code,{children:"$this->init_form_fields();"})," & ",(0,o.jsx)(t.code,{children:"$this->init_settings();"})," You'll also need to save your options by calling the ",(0,o.jsx)(t.code,{children:"woocommerce_update_options_integration_{your method id}"})," hook. Lastly you have to input some settings to save! We've included two dummy fields below but we'll go more into fields in the next section."]}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["Added to a file named ",(0,o.jsx)(t.code,{children:"class-wc-integration-demo-integration.php"})]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"<?php\n/**\n * Integration Demo Integration.\n *\n * @package  WC_Integration_Demo_Integration\n * @category Integration\n * @author   Patrick Rauland\n */\nif ( ! class_exists( 'WC_Integration_Demo_Integration' ) ) :\n    /**\n     * Demo Integration class.\n     */\n    class WC_Integration_Demo_Integration extends WC_Integration {\n        /**\n         * Init and hook in the integration.\n         */\n        public function __construct() {\n            global $woocommerce;\n\n            $this->id                 = 'integration-demo';\n            $this->method_title       = __( 'Integration Demo', 'woocommerce-integration-demo' );\n            $this->method_description = __( 'An integration demo to show you how easy it is to extend WooCommerce.', 'woocommerce-integration-demo' );\n\n            // Load the settings.\n            $this->init_form_fields();\n            $this->init_settings();\n\n            // Define user set variables.\n            $this->api_key = $this->get_option( 'api_key' );\n            $this->debug   = $this->get_option( 'debug' );\n\n            // Actions.\n            add_action( 'woocommerce_update_options_integration_' .  $this->id, array( $this, 'process_admin_options' ) );\n        }\n\n        /**\n         * Initialize integration settings form fields.\n         */\n        public function init_form_fields() {\n            $this->form_fields = array(\n                'api_key' => array(\n                    'title'       => __( 'API Key', 'woocommerce-integration-demo' ),\n                    'type'        => 'text',\n                    'description' => __( 'Enter with your API Key. You can find this in \"User Profile\" drop-down (top right corner) > API Keys.', 'woocommerce-integration-demo' ),\n                    'desc_tip'    => true,\n                    'default'     => '',\n                ),\n                'debug' => array(\n                    'title'       => __( 'Debug Log', 'woocommerce-integration-demo' ),\n                    'type'        => 'checkbox',\n                    'label'       => __( 'Enable logging', 'woocommerce-integration-demo' ),\n                    'default'     => 'no',\n                    'description' => __( 'Log events such as API requests', 'woocommerce-integration-demo' ),\n                ),\n            );\n        }\n    }\nendif;\n"})}),"\n",(0,o.jsxs)(t.blockquote,{children:["\n",(0,o.jsxs)(t.p,{children:["Added to a file named ",(0,o.jsx)(t.code,{children:"wc-integration-demo.php"})]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"<?php\n/**\n * Plugin Name: WooCommerce Integration Demo\n * Plugin URI: https://gist.github.com/BFTrick/091d55feaaef0c5341d8\n * Description: A plugin demonstrating how to add a new WooCommerce integration.\n * Author: Patrick Rauland\n * Author URI: http://speakinginbytes.com/\n * Version: 1.0\n *\n * This program is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with this program. If not, see <http://www.gnu.org/licenses/>.\n *\n */\nif ( ! class_exists( 'WC_Integration_Demo' ) ) :\n    /**\n     * Integration demo class.\n     */\n    class WC_Integration_Demo {\n        /**\n         * Construct the plugin.\n         */\n        public function __construct() {\n            add_action( 'plugins_loaded', array( $this, 'init' ) );\n        }\n\n        /**\n         * Initialize the plugin.\n         */\n        public function init() {\n            // Checks if WooCommerce is installed.\n            if ( class_exists( 'WC_Integration' ) ) {\n                // Include our integration class.\n                include_once 'class-wc-integration-demo-integration.php';\n                // Register the integration.\n                add_filter( 'woocommerce_integrations', array( $this, 'add_integration' ) );\n            } else {\n                // throw an admin error if you like\n            }\n        }\n\n        /**\n         * Add a new integration to WooCommerce.\n         *\n         * @param array Array of integrations.\n         */\n        public function add_integration( $integrations ) {\n            $integrations[] = 'WC_Integration_Demo_Integration';\n            return $integrations;\n        }\n    }\nendif;\n\n$WC_Integration_Demo = new WC_Integration_Demo( __FILE__ );\n\n"})}),"\n",(0,o.jsx)(t.h2,{id:"creating-settings",children:"Creating Settings"}),"\n",(0,o.jsxs)(t.p,{children:["If you took a look through the last section you'll see that we added two dummy settings using the ",(0,o.jsx)(t.code,{children:"init_form_fields()"})," method."]}),"\n",(0,o.jsx)(t.h3,{id:"types-of-settings",children:"Types of Settings"}),"\n",(0,o.jsx)(t.p,{children:"WooCommerce includes support for 8 types of settings."}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"text"}),"\n",(0,o.jsx)(t.li,{children:"price"}),"\n",(0,o.jsx)(t.li,{children:"decimal"}),"\n",(0,o.jsx)(t.li,{children:"password"}),"\n",(0,o.jsx)(t.li,{children:"textarea"}),"\n",(0,o.jsx)(t.li,{children:"checkbox"}),"\n",(0,o.jsx)(t.li,{children:"select"}),"\n",(0,o.jsx)(t.li,{children:"multiselect"}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["And these settings have attributes which you can use. These affect the way the setting looks and behaves on the settings page. It doesn't affect the setting itself. The attributes will manifest slightly differently depending on the setting type. A placeholder for example doesn't work with checkboxes. To see exactly how they work you should look through the ",(0,o.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/blob/trunk/plugins/woocommerce/includes/abstracts/abstract-wc-settings-api.php",title:"WC Settings API on GitHub",children:"source code"}),". Ex."]}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"title"}),"\n",(0,o.jsx)(t.li,{children:"class"}),"\n",(0,o.jsx)(t.li,{children:"css"}),"\n",(0,o.jsx)(t.li,{children:"placeholder"}),"\n",(0,o.jsx)(t.li,{children:"description"}),"\n",(0,o.jsx)(t.li,{children:"default"}),"\n",(0,o.jsx)(t.li,{children:"desc_tip"}),"\n"]}),"\n",(0,o.jsx)(t.h3,{id:"creating-your-own-settings",children:"Creating Your Own Settings"}),"\n",(0,o.jsxs)(t.p,{children:["The built-in settings are great but you may need extra controls to create your settings page. That's why we included some methods to do this for you. First, define a setting by adding it to the ",(0,o.jsx)(t.code,{children:"$this->form_fields"})," array, entering the kind of form control you want under ",(0,o.jsx)(t.code,{children:"type"}),". You can override the default HTML for your form inputs by creating a method with a name of the format ",(0,o.jsx)(t.code,{children:"generate_{ type }_html"})," which outputs HTML markup. To specify how buttons are rendered, you'd add a method called ",(0,o.jsx)(t.code,{children:"generate_button_html"}),". For textareas, you'd add a ",(0,o.jsx)(t.code,{children:"generate_textarea_html"})," method, and so on. (Check out the ",(0,o.jsx)(t.code,{children:"generate_settings_html"})," method of the ",(0,o.jsx)(t.code,{children:"WC_Settings_API"})," class in the WooCommerce source code to see how WooCommerce uses this.) The below example creates a button that goes to WooCommerce.com."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"/**\n * Initialize integration settings form fields.\n *\n * @return void\n */\npublic function init_form_fields() {\n\t$this->form_fields = array(\n\t\t// don't forget to put your other settings here\n\t\t'customize_button' => array(\n\t\t\t'title'             => __( 'Customize!', 'woocommerce-integration-demo' ),\n\t\t\t'type'              => 'button',\n\t\t\t'custom_attributes' => array(\n\t\t\t\t'onclick' => \"location.href='https://woocommerce.com'\",\n\t\t\t),\n\t\t\t'description'       => __( 'Customize your settings by going to the integration site directly.', 'woocommerce-integration-demo' ),\n\t\t\t'desc_tip'          => true,\n\t\t)\n\t);\n}\n\n\n/**\n * Generate Button HTML.\n *\n * @access public\n * @param mixed $key\n * @param mixed $data\n * @since 1.0.0\n * @return string\n */\npublic function generate_button_html( $key, $data ) {\n\t$field    = $this->plugin_id . $this->id . '_' . $key;\n\t$defaults = array(\n\t\t'class'             => 'button-secondary',\n\t\t'css'               => '',\n\t\t'custom_attributes' => array(),\n\t\t'desc_tip'          => false,\n\t\t'description'       => '',\n\t\t'title'             => '',\n\t);\n\n\t$data = wp_parse_args( $data, $defaults );\n\n\tob_start();\n\t?>\n\t<tr valign=\"top\">\n\t\t<th scope=\"row\" class=\"titledesc\">\n\t\t\t<label for=\"<?php echo esc_attr( $field ); ?>\"><?php echo wp_kses_post( $data['title'] ); ?></label>\n\t\t\t<?php echo $this->get_tooltip_html( $data ); ?>\n\t\t</th>\n\t\t<td class=\"forminp\">\n\t\t\t<fieldset<\n\t\t\t\t<legend class=\"screen-reader-text\"><span><?php echo wp_kses_post( $data['title'] ); ?></span></legend>\n\t\t\t\t<button class=\"<?php echo esc_attr( $data['class'] ); ?>\" type=\"button\" name=\"<?php echo esc_attr( $field ); ?>\" id=\"<?php echo esc_attr( $field ); ?>\" style=\"<?php echo esc_attr( $data['css'] ); ?>\" <?php echo $this->get_custom_attribute_html( $data ); ?>><?php echo wp_kses_post( $data['title'] ); ?></button>\n\t\t\t\t<?php echo $this->get_description_html( $data ); ?>\n\t\t\t</fieldset>\n\t\t</td>\n\t</tr>\n\t<?php\n\treturn ob_get_clean();\n}\n"})}),"\n",(0,o.jsx)(t.h2,{id:"validating--sanitizing-data",children:"Validating & Sanitizing Data"}),"\n",(0,o.jsx)(t.p,{children:"To create the best user experience you'll most likely want to validate and sanitize your data. The integration class already performs basic sanitization so that there's no malicious code present but you could further sanitize by removing unused data. An example of sanitizing data would be integrating with a 3rd party service where all API keys are upper case. You could convert the API key to upper case which will make it a bit more clear for the user."}),"\n",(0,o.jsx)(t.h3,{id:"sanitize",children:"Sanitize"}),"\n",(0,o.jsxs)(t.p,{children:["We'll demonstrate how to sanitize data first because it's a bit easier to understand. But the one thing you should keep in mind is that sanitizing happens ",(0,o.jsx)(t.em,{children:"after"})," validation. So if something isn't validated it won't get to the sanitization step."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"/**\n * Init and hook in the integration.\n */\npublic function __construct() {\n\n    // do other constructor stuff first\n\n\t// Filters.\n\tadd_filter( 'woocommerce_settings_api_sanitized_fields_' . $this->id, array( $this, 'sanitize_settings' ) );\n\n}\n\n/**\n * Sanitize our settings\n */\npublic function sanitize_settings( $settings ) {\n\t// We're just going to make the api key all upper case characters since that's how our imaginary API works\n\tif ( isset( $settings ) &&\n\t     isset( $settings['api_key'] ) ) {\n\t\t$settings['api_key'] = strtoupper( $settings['api_key'] );\n\t}\n\treturn $settings;\n}\n"})}),"\n",(0,o.jsx)(t.h3,{id:"validation",children:"Validation"}),"\n",(0,o.jsxs)(t.p,{children:["Validation isn't always necessary but it's nice to do. If your API keys are always 10 characters long and someone enters one that's not 10 then you can print out an error message and prevent the user a lot of headache when they assumed they put it in correctly. First set up a ",(0,o.jsx)(t.code,{children:"validate_{setting key}_field"})," method for each field you want to validate. For example, with the ",(0,o.jsx)(t.code,{children:"api_key"})," field you need a ",(0,o.jsx)(t.code,{children:"validate_api_key_field()"})," method."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"public function validate_api_key_field( $key, $value ) {\n    if ( isset( $value ) && 20 < strlen( $value ) ) {\n        WC_Admin_Settings::add_error( esc_html__( 'Looks like you made a mistake with the API Key field. Make sure it isn&apos;t longer than 20 characters', 'woocommerce-integration-demo' ) );\n    }\n\n    return $value;\n}\n"})}),"\n",(0,o.jsx)(t.h2,{id:"a-complete-example",children:"A complete example"}),"\n",(0,o.jsxs)(t.p,{children:["If you've been following along you should have a complete integration example. If you have any problems see our ",(0,o.jsx)(t.a,{href:"https://github.com/woogists/woocommerce-integration-demo",title:"Integration Demo",children:"full integration demo"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>r});var i=n(6540);const o={},s=i.createContext(o);function a(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);