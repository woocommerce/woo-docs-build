"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[7618],{7666:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"best-practices/data-management/adding-a-custom-field-to-variable-products","title":"How to add a custom field to simple and variable products","description":"In this tutorial you will learn how to create a custom field for a product and show it in your store. Together we will set up the skeleton plugin, and learn about WP naming conventions and WooCommerce hooks. In the end, you will have a functioning plugin for adding a custom field.","source":"@site/../best-practices/data-management/adding-a-custom-field-to-variable-products.md","sourceDirName":"best-practices/data-management","slug":"/best-practices/data-management/adding-a-custom-field-to-variable-products","permalink":"/docs/best-practices/data-management/adding-a-custom-field-to-variable-products","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../best-practices/data-management/adding-a-custom-field-to-variable-products.md","tags":[],"version":"current","frontMatter":{"post_title":"How to add a custom field to simple and variable products","sidebar_label":"Add custom fields to products"},"sidebar":"docsSidebar","previous":{"title":"Translating WooCommerce","permalink":"/docs/best-practices/localization-translation/translating-woocommerce"},"next":{"title":"Using CRUD objects","permalink":"/docs/best-practices/data-management/crud-objects"}}');var a=o(4848),i=o(8453);const s={post_title:"How to add a custom field to simple and variable products",sidebar_label:"Add custom fields to products"},r="How to add a custom field to simple and variable products",d={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Setting up the plugin",id:"setting-up-the-plugin",level:2},{value:"WooCommerce hooks",id:"woocommerce-hooks",level:2},{value:"Creating our class",id:"creating-our-class",level:2},{value:"Adding the custom field",id:"adding-the-custom-field",level:2},{value:"How to handle variable products?",id:"how-to-handle-variable-products",level:2},{value:"How to find hooks?",id:"how-to-find-hooks",level:2}];function l(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.header,{children:(0,a.jsx)(t.h1,{id:"how-to-add-a-custom-field-to-simple-and-variable-products",children:"How to add a custom field to simple and variable products"})}),"\n",(0,a.jsx)(t.p,{children:"In this tutorial you will learn how to create a custom field for a product and show it in your store. Together we will set up the skeleton plugin, and learn about WP naming conventions and WooCommerce hooks. In the end, you will have a functioning plugin for adding a custom field."}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.a,{href:"https://github.com/EdithAllison/woo-product-custom-fields",children:"full plugin code"})," was written based on WordPress 6.2 and WooCommerce 7.6.0"]}),"\n",(0,a.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(t.p,{children:["To do this tutorial you will need to have a WordPress install with the WooCommerce plugin activated, and you will need at least one ",(0,a.jsx)(t.a,{href:"https://woocommerce.com/document/managing-products/",children:"simple product set up"}),", or you can ",(0,a.jsx)(t.a,{href:"https://woocommerce.com/document/importing-woocommerce-sample-data/",children:"import the WooCommerce sample product range"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"setting-up-the-plugin",children:"Setting up the plugin"}),"\n",(0,a.jsxs)(t.p,{children:["To get started, let's do the steps to ",(0,a.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/tree/trunk/packages/js/create-woo-extension",children:"create a skeleton plugin"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"First, navigate to your wp-content/plugins folder, then run:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"npx @wordpress/create-block -t @woocommerce/create-woo-extension woo-product-fields\n"})}),"\n",(0,a.jsx)(t.p,{children:"Then we navigate to our new folder and run the install and build:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"cd woo-product-fields\nnpm install # Install dependencies\nnpm run build # Build the javascript\n"})}),"\n",(0,a.jsxs)(t.p,{children:["WordPress has its own class file naming convention which doesn't work with PSR-4 out of the box. To learn more about Naming Conventions see the ",(0,a.jsx)(t.a,{href:"https://developer.wordpress.org/coding-standards/wordpress-coding-standards/php/#naming-conventions",children:"WP Handbook"}),'. We will use the standard format of "class-my-classname.php" format, so let\'s go to the composer.json file and change the autoload to:']}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-json",children:'"autoload": {\n   \t "classmap": ["includes/", "includes/admin/"]\n    },\n'})}),"\n",(0,a.jsx)(t.p,{children:"After saving run dump-autoload to generate the class map by running in the Terminal:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-sh",children:"composer dump-autoload -o\n"})}),"\n",(0,a.jsx)(t.p,{children:"This generates a new vendor/composer/autoload_classmap.php file containing a list of all our classes in the /includes/ and /includes/admin/ folder. We will need to repeat this command when we add, delete or move class files."}),"\n",(0,a.jsx)(t.h2,{id:"woocommerce-hooks",children:"WooCommerce hooks"}),"\n",(0,a.jsx)(t.p,{children:"Our aim is to create a new custom text field for WooCommerce products to save new stock information for display in the store. To do this, we need to modify the section of the Woo data in the admin area which holds the stock info."}),"\n",(0,a.jsxs)(t.p,{children:["WooCommerce allows us to add our code to these sections through ",(0,a.jsx)(t.a,{href:"https://developer.wordpress.org/plugins/hooks/",children:"hooks"}),', which are a standard WordPress method to extend code. In the "Inventory" section we have the following action hooks available to us:']}),"\n",(0,a.jsxs)(t.p,{children:["For our Woo extension, we'll be appending our field right at the end with ",(0,a.jsx)(t.code,{children:"woocommerce_product_options_inventory_product_data"}),"."]}),"\n",(0,a.jsx)(t.h2,{id:"creating-our-class",children:"Creating our class"}),"\n",(0,a.jsxs)(t.p,{children:["Let's get started with creating a new class which will hold the code for the field. Add a new file with the name ",(0,a.jsx)(t.code,{children:"class-product-fields.php"})," to the ",(0,a.jsx)(t.code,{children:"/includes/admin/"})," folder. Within the class, we add our namespace, an abort if anyone tries to call the file directly and a __construct method which calls the ",(0,a.jsx)(t.code,{children:"hooks()"})," method:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"<?php\n\nnamespace WooProductField\\Admin;\n\ndefined( 'ABSPATH' ) || exit;\n\nclass ProductFields {\n\n    public function __construct() {\n\t\t$this->hooks();\n    }\n\n    private function hooks() {}\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Then in Terminal we run ",(0,a.jsx)(t.code,{children:"composer dump-autoload -o"})," to regenerate the class map. Once that's done, we add the class to our ",(0,a.jsx)(t.code,{children:"setup.php"})," __construct() function like so:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"class Setup {\n    public function __construct() {\n\t\tadd_action( 'admin_enqueue_scripts', array( $this, 'register_scripts' ) );\n\n\t\tnew ProductFields();\n    }\n"})}),"\n",(0,a.jsx)(t.h2,{id:"adding-the-custom-field",children:"Adding the custom field"}),"\n",(0,a.jsxs)(t.p,{children:["With the class set up and being called, we can create a function to add the custom field. WooCommerce has its own ",(0,a.jsx)(t.code,{children:"woocommerce_wp_text_input( $args )"})," function which we can use here. ",(0,a.jsx)(t.code,{children:"$args"})," is an array which allows us to set the text input data, and we will be using the global $product_object to access stored metadata."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function add_field() {\n\tglobal $product_object;\n\t?>\n\t<div class=\"inventory_new_stock_information options_group show_if_simple show_if_variable\">\n\t\t<?php woocommerce_wp_text_input(\n\t\t\tarray(\n\t\t\t\t'id'      \t=> '_new_stock_information',\n\t\t\t\t'label'   \t=> __( 'New Stock', 'woo_product_field' ),\n\t\t\t\t'description' => __( 'Information shown in store', 'woo_product_field' ),\n\t\t\t\t'desc_tip'\t=> true,\n\t\t\t\t'value' => $product_object->get_meta( '_new_stock_information' )\n\t\t\t)\n\t\t); ?>\n\t</div>\n\t<?php\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Let's take a look at the arguments in the array. The ID will be used as meta_key in the database. The Label and Description are shown in the data section, and by setting desc_tip to true, it will be shown as a hover over the info icon. The last argument value ensures that if a value is already stored, then it will be shown."}),"\n",(0,a.jsxs)(t.p,{children:["For the div class, the class names ",(0,a.jsx)(t.code,{children:"show_if_simple"})," and ",(0,a.jsx)(t.code,{children:"show_if_variable"})," will control when our section is shown. This is linked to JS code which dynamically hides/reveals sections. If for example, we wanted to hide the section from variable products, then we can simply delete ",(0,a.jsx)(t.code,{children:"show_if_variable"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Now that we have our field, we need to save it. For this, we can hook into woocommerce_process_product_meta which takes two arguments, ",(0,a.jsx)(t.code,{children:"$post_id"})," and ",(0,a.jsx)(t.code,{children:"$post"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function save_field( $post_id, $post ) {\n\tif ( isset( $_POST['_new_stock_information'] ) ) {\n\t\t$product = wc_get_product( intval( $post_id ) );\n\t\t$product->update_meta_data( '_new_stock_information', sanitize_text_field( $_POST['_new_stock_information'] ) );\n\t\t$product->save_meta_data();\n\t}\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["This function checks if our new field is in the POST array. If yes, we create the product object, update our metadata and save the metadata. The ",(0,a.jsx)(t.code,{children:"update_meta_data"})," function will either update an existing meta field or add a new one. And as we're inserting into the database, we must ",(0,a.jsx)(t.a,{href:"https://developer.wordpress.org/apis/security/sanitizing/",children:"sanitize our field value"}),"."]}),"\n",(0,a.jsx)(t.p,{children:"And to make it all work, we add the hooks:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"private function hooks() {\n\tadd_action( 'woocommerce_product_options_inventory_product_data', array( $this, 'add_field' ) );\n\tadd_action( 'woocommerce_process_product_meta', array( $this, 'save_field' ), 10, 2 );\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"Now if we refresh our product screen, we can see our new field."}),"\n",(0,a.jsx)(t.p,{children:"If we add data and save the product, then the new meta data is inserted into the database."}),"\n",(0,a.jsxs)(t.p,{children:["At this point you have a working extension that saves a custom field for a product as product meta.\nShowing the field in the store\nIf we want to display the new field in our store, then we can do this with the ",(0,a.jsx)(t.code,{children:"get_meta()"})," method of the Woo product class: ",(0,a.jsx)(t.code,{children:"$product->get_meta( '\\_new_stock_information' )"})]}),"\n",(0,a.jsxs)(t.p,{children:["Let's get started by creating a new file /includes/class-product.php. You may have noticed that this is outside the ",(0,a.jsx)(t.code,{children:"/admin/"})," folder as this code will run in the front. So when we set up the class, we also adjust the namespace accordingly:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"<?php\n\nnamespace WooProductField;\n\ndefined( 'ABSPATH' ) || exit;\n\nclass Product {\n    public function __construct() {\n\t\t$this->hooks();\n    }\n\n    private function hooks() { }\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Again we run ",(0,a.jsx)(t.code,{children:"composer dump-autoload -o"})," to update our class map."]}),"\n",(0,a.jsxs)(t.p,{children:["If you took a look at the extension setup you may have noticed that ",(0,a.jsx)(t.code,{children:"/admin/setup.php"})," is only called if we're within WP Admin. So to call our new class we'll add it directly in ",(0,a.jsx)(t.code,{children:"/woo-product-field.php"}),":"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function __construct() {\n\tif ( is_admin() ) {\n\t\tnew Setup();\n\t}\n\tnew WooProductField\\Product();\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["For adding the field to the front we have several options. We could create a theme template, but if we are working with a WooCommerce-compatible theme and don't need to make any other changes then a quick way is to use hooks. If we look into ",(0,a.jsx)(t.code,{children:"/woocommerce/includes/wc-template-hooks.php"})," we can see all the existing actions for ",(0,a.jsx)(t.code,{children:"woocommerce_single_product_summary"})," which controls the section at the top of the product page:"]}),"\n",(0,a.jsx)(t.p,{children:"For our extension, let's add the new stock information after the excerpt by using 21 as the priority:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"private function hooks() {\n\tadd_action( 'woocommerce_single_product_summary', array( $this, 'add_stock_info' ), 21 );\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["In our function we output the stock information with the ",(0,a.jsx)(t.a,{href:"https://developer.wordpress.org/apis/security/escaping/",children:"appropriate escape function"}),", in this case, I'm suggesting to use ",(0,a.jsx)(t.code,{children:"esc_html()"})," to force plain text."]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function add_stock_info() {\n\tglobal $product;\n\t?>\n\t<p><?php echo esc_html( $product->get_meta( '_new_stock_information' ) ); ?> </p>\n\t<?php\n\n    }\n"})}),"\n",(0,a.jsx)(t.p,{children:"Now if we refresh the product page our stock information will be shown just below the excerpt:"}),"\n",(0,a.jsx)(t.p,{children:"Fantastic! You have completed this tutorial and have a working WooCommerce extension that adds a new custom field and shows it in the store! \ud83c\udf89I hope it's shown you how easily you can extend WooCommerce through hooks and tailor it to your or your client's shop requirements!"}),"\n",(0,a.jsx)(t.p,{children:"Below is a bonus task if you are interested in variable products. Feel free to come back to this later."}),"\n",(0,a.jsx)(t.h2,{id:"how-to-handle-variable-products",children:"How to handle variable products?"}),"\n",(0,a.jsxs)(t.p,{children:["The above example was done with a simple product. But what if we have variations, for example, a T-Shirt in multiple sizes and we wanted to store different stock information for each variant? WooCommerce lets us do that with the ",(0,a.jsx)(t.a,{href:"https://woocommerce.com/document/variable-product/",children:"variable product type"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["A variable product type has variations as its children. To add a custom field to a variation, we can use the ",(0,a.jsx)(t.code,{children:"woocommerce_variation_options_inventory"})," hook, and to save ",(0,a.jsx)(t.code,{children:"woocommerce_save_product_variation"})," so let's update our ",(0,a.jsx)(t.code,{children:"hooks()"})," method with the new action hooks like so:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"private function hooks() {\n\tadd_action( 'woocommerce_product_options_inventory_product_data', array( $this, 'add_field' ) );\n\tadd_action( 'woocommerce_process_product_meta', array( $this, 'save_field' ), 10, 2 );\n\n\tadd_action( 'woocommerce_variation_options_inventory', array( $this, 'add_variation_field' ), 10, 3 );\n\tadd_action( 'woocommerce_save_product_variation', array( $this, 'save_variation_field' ), 10, 2 );\n}\n"})}),"\n",(0,a.jsxs)(t.p,{children:["The setup is very similar to simple products, the main difference is that we need to use the $loop id which distinguishes between the variations, and we will be using the ",(0,a.jsx)(t.code,{children:"wrapper_class"})," to show it as a full width text input:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function add_variation_field( $loop, $variation_data, $variation ) {\n\t$variation_product = wc_get_product( $variation->ID );\n\n\twoocommerce_wp_text_input(\n\t\tarray(\n\t\t\t'id' => '\\_new_stock_information' . '[' . $loop . ']',\n\t\t\t'label' => \\_\\_( 'New Stock Information', 'woo_product_field' ),\n\t\t\t'wrapper_class' => 'form-row form-row-full',\n\t\t\t'value' => $variation_product->get_meta( '\\_new_stock_information' )\n\t\t)\n\t);\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:"For saving we use:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-php",children:"public function save_variation_field( $variation_id, $i  ) {\n\tif ( isset( $_POST['_new_stock_information'][$i] ) ) {\n\t\t$variation_product = wc_get_product( $variation_id );\n\t\t$variation_product->update_meta_data( '_new_stock_information', sanitize_text_field( $_POST['_new_stock_information'][$i] ) );\n\t\t$variation_product->save_meta_data();\n\t}\n}\n"})}),"\n",(0,a.jsx)(t.p,{children:'And we now have a new variation field that stores our new stock information. If you cannot see the new field, please make sure to enable "Manage Stock" for the variation by ticking the checkbox in the variation details.'}),"\n",(0,a.jsxs)(t.p,{children:["Displaying the variation in the front store works a bit differently for variable products as only some content on the page is updated when the customer makes a selection. This exceeds the scope of this tutorial, but if you are interested have a look at ",(0,a.jsx)(t.code,{children:"/woocommerce/assets/js/frontend/add-to-cart-variation.js"})," to see how WooCommerce does it."]}),"\n",(0,a.jsx)(t.h2,{id:"how-to-find-hooks",children:"How to find hooks?"}),"\n",(0,a.jsxs)(t.p,{children:["Everyone will have their own preferred way, but for me, the quickest way is to look in the WooCommerce plugin code. The code for each data section can be found in ",(0,a.jsx)(t.code,{children:"/woocommerce/includes/admin/meta-boxes/views"}),". To view how the inventory section is handled check the ",(0,a.jsx)(t.code,{children:"html-product-data-inventory.php"})," file, and for variations take a look at ",(0,a.jsx)(t.code,{children:"html-variation-admin.php"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>r});var n=o(6540);const a={},i=n.createContext(a);function s(e){const t=n.useContext(i);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);