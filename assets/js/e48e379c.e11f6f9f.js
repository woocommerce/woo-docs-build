"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[4615],{7517:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"features/high-performance-order-storage/wc-order-query-improvements","title":"HPOS order querying APIs","description":"With the introduction of HPOS, we\'ve enhanced the querying functionality in WC. Now, in addition to the well-known existing APIs, we\'re adding a few features that would make it easier to create complex queries on orders or their properties, including the ability to query custom order metadata.","source":"@site/../features/high-performance-order-storage/wc-order-query-improvements.md","sourceDirName":"features/high-performance-order-storage","slug":"/features/high-performance-order-storage/wc-order-query-improvements","permalink":"/docs/features/high-performance-order-storage/wc-order-query-improvements","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../features/high-performance-order-storage/wc-order-query-improvements.md","tags":[],"version":"current","frontMatter":{"post_title":"HPOS order querying APIs"},"sidebar":"docsSidebar","previous":{"title":"HPOS extension recipe book","permalink":"/docs/features/high-performance-order-storage/recipe-book"},"next":{"title":"Theming for Woo blocks","permalink":"/docs/theming/block-theme-development/theming-woo-blocks"}}');var t=n(4848),o=n(8453);const s={post_title:"HPOS order querying APIs"},i="HPOS order querying APIs",d={},c=[{value:"The new query types",id:"the-new-query-types",level:2},{value:"Metadata queries (<code>meta_query</code>)",id:"metadata-queries-meta_query",level:3},{value:"Order field queries (<code>field_query</code>)",id:"order-field-queries-field_query",level:3},{value:"Date queries (<code>date_query</code>)",id:"date-queries-date_query",level:3},{value:"Advanced Examples",id:"advanced-examples",level:2}];function l(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"hpos-order-querying-apis",children:"HPOS order querying APIs"})}),"\n",(0,t.jsxs)(r.p,{children:["With the introduction of HPOS, we've enhanced the querying functionality in WC. Now, in addition to the well-known ",(0,t.jsx)(r.a,{href:"https://github.com/woocommerce/woocommerce/wiki/wc_get_orders-and-WC_Order_Query",children:"existing APIs"}),", we're adding a few features that would make it easier to create complex queries on orders or their properties, including the ability to query custom order metadata."]}),"\n",(0,t.jsxs)(r.p,{children:["All the new query types are implemented as additional query arguments that can be passed to ",(0,t.jsx)(r.code,{children:"wc_get_orders()"})," and are heavily inspired by similar functionality in WordPress' own ",(0,t.jsx)(r.code,{children:"WP_Query"}),". As regular query arguments, they can be combined with other arguments to produce complex queries that, until now, would have required writing custom code and SQL."]}),"\n",(0,t.jsx)(r.h2,{id:"the-new-query-types",children:"The new query types"}),"\n",(0,t.jsxs)(r.h3,{id:"metadata-queries-meta_query",children:["Metadata queries (",(0,t.jsx)(r.code,{children:"meta_query"}),")"]}),"\n",(0,t.jsxs)(r.p,{children:["With the introduction of HPOS, order fields that were previously stored as post metadata have been moved to their own tables, but the remaining metadata (custom, or from other extensions) can now be queried through the ",(0,t.jsx)(r.code,{children:"meta_query "}),"argument."]}),"\n",(0,t.jsxs)(r.p,{children:["At its core, ",(0,t.jsx)(r.code,{children:"meta_query"})," is an array that can contain one or more arrays with keys:\n",(0,t.jsx)(r.code,{children:"key"})," (the meta key name),\n",(0,t.jsx)(r.code,{children:"value"})," (the meta value)\n",(0,t.jsx)(r.code,{children:"compare"})," (optional) an operator to use for comparison purposes such as LIKE, RLIKE, NOT BETWEEN, BETWEEN, etc.\n",(0,t.jsx)(r.code,{children:"type"})," to cast the meta value to a specific SQL type in the query"]}),"\n",(0,t.jsxs)(r.p,{children:["The different arrays can also be combined using ",(0,t.jsx)(r.code,{children:"relation"})," (which admits 'AND' or 'OR' values) to produce more complex queries. The syntax for this new argument is exactly the same as for WP_Query's ",(0,t.jsx)(r.code,{children:"meta_query"}),". As such, you can refer to the ",(0,t.jsxs)(r.a,{href:"https://developer.wordpress.org/reference/classes/wp_query/#custom-field-post-meta-parameters",children:[(0,t.jsx)(r.code,{children:"meta_query"})," docs"]})," for more details."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Example: obtain all orders which have metadata with the \"color\" key (any value) and have metadata\n// with key \"size\" containing \"small\" (so it'd match \"extra-small\" as well as \"small\", for example).\n$orders = wc_get_orders(\n    array(\n        'meta_query' => array(\n            array(\n                'key' => 'color',\n            ),\n            array(\n                'key'        => 'size',\n                'value'      => 'small',\n                'compare'    => 'LIKE'\n            ),\n        ),\n    )\n);\n"})}),"\n",(0,t.jsxs)(r.h3,{id:"order-field-queries-field_query",children:["Order field queries (",(0,t.jsx)(r.code,{children:"field_query"}),")"]}),"\n",(0,t.jsxs)(r.p,{children:["This query type has a syntax similar to that of meta queries (",(0,t.jsx)(r.code,{children:"meta_query"}),") but instead of ",(0,t.jsx)(r.code,{children:"key"})," you'd use ",(0,t.jsx)(r.code,{children:"field"})," inside the different clauses. Here, ",(0,t.jsx)(r.code,{children:"field"})," refers to any order property (such as ",(0,t.jsx)(r.code,{children:"billing_first_name"}),", ",(0,t.jsx)(r.code,{children:"total"})," or ",(0,t.jsx)(r.code,{children:"order_key"}),", etc.) which are also accessible as top-level keys in the query arguments as usual. The difference between directly querying those properties and using a ",(0,t.jsx)(r.code,{children:"field_query"})," is that you can create more complex queries by implementing comparison operators and combining or nesting."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Example. For a simple query, you'd be better off by using the order properties directly, even though there's a `field_query` equivalent.\n$orders = wc_get_orders(\n    array(\n        'billing_first_name' => 'Lauren',\n        'order_key'          => 'my_order_key',\n    )\n);\n\n$orders = wc_get_orders(\n    array(\n        'field_query' => array(\n            array(\n                'field' => 'billing_first_name',\n                'value' => 'Lauren'\n            ),\n            array(\n                'field' => 'order_key',\n                'value' => 'my_order_key',\n            )\n        )\n    )\n);\n"})}),"\n",(0,t.jsxs)(r.p,{children:["The true power of ",(0,t.jsx)(r.code,{children:"field_query"})," is revealed when you want to perform more interesting queries, that were not possible before..."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Example. Obtain all orders where either the total or shipping total is less than 5.0.\n\n$orders = wc_get_orders(\n    array(\n        'field_query' => array(\n            'relation' => 'OR',\n            array(\n                'field'   => 'total',\n                'value'   => '5.0',\n                'compare' => '<',\n            ),\n            array(\n                'field'   => 'shipping_total',\n                'value'   => '5.0',\n                'compare' => '<',\n            ),\n        )\n    )\n);\n"})}),"\n",(0,t.jsxs)(r.h3,{id:"date-queries-date_query",children:["Date queries (",(0,t.jsx)(r.code,{children:"date_query"}),")"]}),"\n",(0,t.jsxs)(r.p,{children:["Date queries allow you to fetch orders by querying their associated dates (",(0,t.jsx)(r.code,{children:"date_completed"}),", ",(0,t.jsx)(r.code,{children:"date_created"}),", ",(0,t.jsx)(r.code,{children:"date_updated"}),", ",(0,t.jsx)(r.code,{children:"date_paid"}),") in various ways.\nThe syntax for ",(0,t.jsx)(r.code,{children:"date_query"})," is fully compatible with that of ",(0,t.jsx)(r.code,{children:"date_query"})," in ",(0,t.jsx)(r.code,{children:"WP_Query"}),". As such, a good source of examples and details is ",(0,t.jsxs)(r.a,{href:"https://developer.wordpress.org/reference/classes/wp_query/#date-parameters",children:["the ",(0,t.jsx)(r.code,{children:"meta_query"})," docs"]})," in the WP codex."]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Example. Obtain all orders paid in the last month that were created before noon (on any date).\n\n$orders = wc_get_orders(\n    array(\n        'date_query' => array(\n            'relation' => 'AND',\n            array(\n                'column'  => 'date_created_gmt',\n                'hour'    => 12,\n                'compare' => '<'\n            ),\n            array(\n                'column'  => 'date_paid_gmt',\n                'after'   => '1 month ago',\n            ),\n        ),\n    )\n);\n"})}),"\n",(0,t.jsx)(r.h2,{id:"advanced-examples",children:"Advanced Examples"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Obtain orders either \"on-hold\" or \"pending\" that have metadata `weight` >= 50 and metadata `color` or `size` is set.\n\n$query_args = array(\n    'status' => array( 'pending', 'on-hold' ),\n    'meta_query' => array(\n        array(\n            'key'     => 'weight',\n            'value'   => '50',\n            'compare' => '>=',\n        ),\n        array(\n            'relation' => 'OR',\n            array(\n                'key'     => 'color',\n                'compare' => 'EXISTS',\n            ),\n            array(\n                'key'     => 'size',\n                'compare' => 'EXISTS',\n            )\n        ),\n    )\n);\n\n$orders = wc_get_orders( $query_args );\n"})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-php",children:"// Obtain orders where the first name in the billing details contains \"laur\" (so it'd both match \"lauren\" and \"laura\", for example), and where the order's total is less than 10.0 and the total discount is >= 5.0.\n\n$orders = wc_get_orders(\n    array(\n        'field_query' => array(\n            array(\n                'field'   => 'billing_first_name',\n                'value'   => 'laur',\n                'compare' => 'LIKE',\n            ),\n            array(\n                'relation' => 'AND',\n                array(\n                    'field'   => 'total',\n                    'value'   => '10.0',\n                    'compare' => '<',\n                    'type'    => 'NUMERIC',\n                ),\n                array(\n                    'field'   => 'discount_total',\n                    'value'   => '5.0',\n                    'compare' => '>=',\n                    'type'    => 'NUMERIC',\n                )\n            )\n        ),\n    )\n);\n"})})]})}function h(e={}){const{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>s,x:()=>i});var a=n(6540);const t={},o=a.createContext(t);function s(e){const r=a.useContext(o);return a.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),a.createElement(o.Provider,{value:r},e.children)}}}]);