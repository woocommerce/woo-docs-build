"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[1256],{7619:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>g,frontMatter:()=>c,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"extensions/extension-onboarding/integrating-coming-soon-mode","title":"Integrating with coming soon mode","description":"This guide provides examples for third-party developers and hosting providers on how to integrate their systems with WooCommerce\'s coming soon mode. For more details, please read the developer blog post. For site visibility settings, please refer to the admin documentation.","source":"@site/../extensions/extension-onboarding/integrating-coming-soon-mode.md","sourceDirName":"extensions/extension-onboarding","slug":"/extensions/extension-onboarding/integrating-coming-soon-mode","permalink":"/docs/extensions/extension-onboarding/integrating-coming-soon-mode","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../extensions/extension-onboarding/integrating-coming-soon-mode.md","tags":[],"version":"current","frontMatter":{"post_title":"Integrating with coming soon mode"},"sidebar":"extensionsSidebar","previous":{"title":"Implement merchant onboarding","permalink":"/docs/extensions/extension-onboarding/handling-merchant-onboarding"},"next":{"title":"Extension guidelines","permalink":"/docs/extensions/ux-guidelines-extensions/"}}');var s=o(4848),t=o(8453);const c={post_title:"Integrating with coming soon mode"},r="Integrating with coming soon mode",a={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step-by-step instructions",id:"step-by-step-instructions",level:2},{value:"Clear server cache on site visibility settings change",id:"clear-server-cache-on-site-visibility-settings-change",level:3},{value:"Clear server cache on template changes",id:"clear-server-cache-on-template-changes",level:3},{value:"Syncing coming soon mode with other plugins",id:"syncing-coming-soon-mode-with-other-plugins",level:3},{value:"Trigger from WooCommerce",id:"trigger-from-woocommerce",level:4},{value:"Trigger from other plugins",id:"trigger-from-other-plugins",level:4},{value:"2-way sync with plugins",id:"2-way-sync-with-plugins",level:4},{value:"One-way binding with option override",id:"one-way-binding-with-option-override",level:4},{value:"Custom exclusions filter",id:"custom-exclusions-filter",level:3},{value:"Disabling coming soon in all pages",id:"disabling-coming-soon-in-all-pages",level:4},{value:"Disabling coming soon except for a specific page",id:"disabling-coming-soon-except-for-a-specific-page",level:4},{value:"Custom share links",id:"custom-share-links",level:4},{value:"Extend &quot;Apply to store pages only&quot; setting",id:"extend-apply-to-store-pages-only-setting",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"integrating-with-coming-soon-mode",children:"Integrating with coming soon mode"})}),"\n",(0,s.jsxs)(n.p,{children:["This guide provides examples for third-party developers and hosting providers on how to integrate their systems with WooCommerce's coming soon mode. For more details, please read the ",(0,s.jsx)(n.a,{href:"https://developer.woocommerce.com/2024/06/18/introducing-coming-soon-mode/",children:"developer blog post"}),". For site visibility settings, please refer to the ",(0,s.jsx)(n.a,{href:"https://woocommerce.com/document/configuring-woocommerce-settings/coming-soon-mode/",children:"admin documentation"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,s.jsx)(n.p,{children:"WooCommerce's coming soon mode allows you to temporarily make your site invisible to the public while you work on it. This guide will show you how to integrate this feature with your system, clear server cache when site visibility settings change, and sync coming soon mode with other plugins."}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Familiarity with PHP and WordPress development."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"step-by-step-instructions",children:"Step-by-step instructions"}),"\n",(0,s.jsx)(n.h3,{id:"clear-server-cache-on-site-visibility-settings-change",children:"Clear server cache on site visibility settings change"}),"\n",(0,s.jsxs)(n.p,{children:["When the site's visibility settings change, it may be necessary to clear a server cache to apply the changes and re-cache customer-facing pages. The ",(0,s.jsx)(n.a,{href:"https://developer.wordpress.org/reference/hooks/update_option/",children:(0,s.jsx)(n.code,{children:"update_option"})})," hook can be used to achieve this."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_action( 'update_option_woocommerce_coming_soon', 'clear_server_cache', 10, 3 );\nadd_action( 'update_option_woocommerce_store_pages_only', 'clear_server_cache', 10, 3 );\n\nfunction clear_server_cache( $old_value, $new_value, $option ) {\n    // Implement your logic to clear the server cache.\n    if ( function_exists( 'your_cache_clear_function' ) ) {\n        your_cache_clear_function();\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"clear-server-cache-on-template-changes",children:"Clear server cache on template changes"}),"\n",(0,s.jsxs)(n.p,{children:["By default, Coming-soon pages are set with ",(0,s.jsx)(n.code,{children:"Cache-Control: max-age=60"})," header. This setting enables CDNs and other caching mechanisms to cache the page for 60 seconds, balancing the need for efficient performance with reasonable update times."]}),"\n",(0,s.jsx)(n.p,{children:"When the user changes the coming soon template, it's recommended that any cache be purged so the changes take effect immediately when the client-side cache expires."}),"\n",(0,s.jsxs)(n.p,{children:["You can use the ",(0,s.jsx)(n.code,{children:"save_post_wp_template"}),", ",(0,s.jsx)(n.code,{children:"save_post_wp_template_part"}),", and ",(0,s.jsx)(n.code,{children:"save_post_wp_global_styles"})," hooks to detect when a template is updated and trigger the cache purge."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_action( 'save_post_wp_template', 'purge_cache_on_template_change', 10, 3 );\nadd_action( 'save_post_wp_template_part', 'purge_cache_on_template_change', 10, 3 );\nadd_action( 'save_post_wp_global_styles', 'purge_cache_on_template_change', 10, 3 );\n\nfunction purge_cache_on_template_change( $post_id, $post, $update ) {\n    // Check if the template is associated with the coming soon mode.\n    if ( 'coming-soon' === $post->post_name ) {\n        // Implement your logic to clear the server cache.\n        if ( function_exists( 'your_cache_clear_function' ) ) {\n            your_cache_clear_function();\n        }\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"syncing-coming-soon-mode-with-other-plugins",children:"Syncing coming soon mode with other plugins"}),"\n",(0,s.jsx)(n.p,{children:"The coming soon mode can be programmatically synced from a plugin or application. Here are some example use cases:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Integrating with a maintenance mode plugin."}),"\n",(0,s.jsx)(n.li,{children:"Integrating with a hosting provider's coming soon mode."}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"trigger-from-woocommerce",children:"Trigger from WooCommerce"}),"\n",(0,s.jsx)(n.p,{children:"You can use the following example to run a code such as setting your plugin's status when coming soon mode option is updated:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_action( 'update_option_woocommerce_coming_soon', 'sync_coming_soon_to_other_plugins', 10, 3 );\n\nfunction sync_coming_soon_to_other_plugins( $old_value, $new_value, $option ) {\n    $is_enabled = $new_value === 'yes';\n\n    // Implement your logic to sync coming soon status.\n    if ( function_exists( 'your_plugin_set_coming_soon' ) ) {\n        your_plugin_set_coming_soon( $is_enabled );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"trigger-from-other-plugins",children:"Trigger from other plugins"}),"\n",(0,s.jsxs)(n.p,{children:["You can use the following example to enable or disable WooCommerce coming soon mode from another plugin by directly updating ",(0,s.jsx)(n.code,{children:"woocommerce_coming_soon"})," option:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"function sync_coming_soon_from_other_plugins( $is_enabled ) {\n    // Check user capability.\n    if ( ! current_user_can( 'manage_options' ) ) {\n        wp_die( 'You do not have sufficient permissions to access this page.' );\n    }\n\n    // Set coming soon mode.\n    if ( isset( $is_enabled ) ) {\n        update_option( 'woocommerce_coming_soon', $is_enabled ? 'yes' : 'no' );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"2-way-sync-with-plugins",children:"2-way sync with plugins"}),"\n",(0,s.jsxs)(n.p,{children:["If 2-way sync is needed, use the following example where ",(0,s.jsx)(n.code,{children:"update_option"})," will not recursively call ",(0,s.jsx)(n.code,{children:"sync_coming_soon_from_other_plugins"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_action( 'update_option_woocommerce_coming_soon', 'sync_coming_soon_to_other_plugins', 10, 3 );\n\nfunction sync_coming_soon_to_other_plugins( $old_value, $new_value, $option ) {\n    $is_enabled = $new_value === 'yes';\n\n    // Implement your logic to sync coming soon status.\n    if ( function_exists( 'your_plugin_set_coming_soon' ) ) {\n        your_plugin_set_coming_soon( $is_enabled );\n    }\n}\n\nfunction sync_coming_soon_from_other_plugins( $is_enabled ) {\n    // Check user capability.\n    if ( ! current_user_can( 'manage_options' ) ) {\n        wp_die( 'You do not have sufficient permissions to access this page.' );\n    }\n\n    if ( isset( $is_enabled ) ) {\n        // Temporarily remove the action to prevent a recursive call.\n        remove_action( 'update_option_woocommerce_coming_soon', 'sync_coming_soon_to_other_plugins', 10, 3 );\n\n        // Set coming soon mode.\n        update_option( 'woocommerce_coming_soon', $is_enabled ? 'yes' : 'no' );\n\n        // Re-add the action.\n        add_action( 'update_option_woocommerce_coming_soon', 'sync_coming_soon_to_other_plugins', 10, 3 );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h4,{id:"one-way-binding-with-option-override",children:"One-way binding with option override"}),"\n",(0,s.jsxs)(n.p,{children:["We could also programmatically bind the coming soon option from another plugin by overriding the ",(0,s.jsx)(n.code,{children:"woocommerce_coming_soon"})," option. This is advantageous since it simplifies state management and prevents possible out-of-sync issues."]}),"\n",(0,s.jsxs)(n.p,{children:["In the following example, we're binding the coming soon option from another plugin by overriding the ",(0,s.jsx)(n.code,{children:"woocommerce_coming_soon"})," option."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_filter( 'pre_option_woocommerce_coming_soon', 'override_option_woocommerce_coming_soon' );\n\nfunction override_option_woocommerce_coming_soon( $current_value ) {\n    // Implement your logic to sync coming soon status.\n    if ( function_exists( 'your_plugin_is_coming_soon' ) ) {\n        return your_plugin_is_coming_soon() ? 'yes' : 'no';\n    }\n    return $current_value;\n}\n\nadd_filter( 'pre_update_option_woocommerce_coming_soon', 'override_update_woocommerce_coming_soon', 10, 2 );\n\nfunction override_update_woocommerce_coming_soon( $new_value, $old_value ) {\n    // Check user capability.\n    if ( ! current_user_can( 'manage_options' ) ) {\n        wp_die( 'You do not have sufficient permissions to access this page.' );\n    }\n\n    // Implement your logic to sync coming soon status.\n    if ( function_exists( 'your_plugin_set_coming_soon' ) ) {\n        your_plugin_set_coming_soon( $new_value === 'yes' );\n    }\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"custom-exclusions-filter",children:"Custom exclusions filter"}),"\n",(0,s.jsx)(n.p,{children:"It is possible for developers to add custom exclusions that bypass the coming soon protection. This is useful for exclusions like always bypassing the screen on a specific IP address, or making a specific landing page available."}),"\n",(0,s.jsx)(n.h4,{id:"disabling-coming-soon-in-all-pages",children:"Disabling coming soon in all pages"}),"\n",(0,s.jsx)(n.p,{children:"If there is another feature that behaves similarly to WooCommerce's coming soon mode, it can cause unintended conflicts. The coming soon mode can be disabled by excluding all customer-facing pages. The following is an example:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_filter( 'woocommerce_coming_soon_exclude', function() {\n    return true;\n}, 10 );\n"})}),"\n",(0,s.jsx)(n.h4,{id:"disabling-coming-soon-except-for-a-specific-page",children:"Disabling coming soon except for a specific page"}),"\n",(0,s.jsxs)(n.p,{children:["Use the following example to exclude a certain page based on the page's ID. Replace ",(0,s.jsx)(n.code,{children:"<page-id>"})," with your page identifier:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_filter( 'woocommerce_coming_soon_exclude', function( $is_excluded ) {\n    if ( get_the_ID() === <page-id> ) {\n        return true;\n    }\n    return $is_excluded;\n}, 10 );\n"})}),"\n",(0,s.jsx)(n.h4,{id:"custom-share-links",children:"Custom share links"}),"\n",(0,s.jsx)(n.p,{children:"The following example shows how to integrate with a custom share code. We recommend using cookies or other storage to persist the access when users navigate across the site:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_filter( 'woocommerce_coming_soon_exclude', function( $exclude ) {\n    // Implement your logic to get and validate share code.\n    if ( function_exists( 'your_plugin_get_share_code' ) && function_exists( 'your_plugin_is_valid_share_code' ) ) {\n        $share_code = your_plugin_get_share_code();\n        if ( your_plugin_is_valid_share_code( $share_code ) ) {\n            return true;\n        }\n    }\n\n    return $exclude;\n} );\n"})}),"\n",(0,s.jsx)(n.h3,{id:"extend-apply-to-store-pages-only-setting",children:'Extend "Apply to store pages only" setting'}),"\n",(0,s.jsxs)(n.p,{children:["When using the ",(0,s.jsx)(n.code,{children:"Apply to store pages only"})," setting, you may want to add a custom page to the list of store pages which will be restricted by coming soon mode. You can use the following example to add a custom page:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-php",children:"add_filter( 'woocommerce_store_pages', function( $pages ) {\n    $page = get_page_by_path( 'your-page-slug' );\n    if ( $page ) {\n        $pages[] = $page->ID;\n    }\n    return $pages;\n} );\n"})})]})}function g(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>c,x:()=>r});var i=o(6540);const s={},t=i.createContext(s);function c(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);