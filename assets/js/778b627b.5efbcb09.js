"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[4140],{8453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var o=n(6540);const i={},a=o.createContext(i);function s(e){const t=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(a.Provider,{value:t},e.children)}},9830:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"block-development/cart-and-checkout-blocks/checkout-payment-methods/filtering-payment-methods","title":"Filtering payment methods in the Checkout block","description":"The problem","source":"@site/../block-development/cart-and-checkout-blocks/checkout-payment-methods/filtering-payment-methods.md","sourceDirName":"block-development/cart-and-checkout-blocks/checkout-payment-methods","slug":"/block-development/cart-and-checkout-blocks/checkout-payment-methods/filtering-payment-methods","permalink":"/docs/block-development/cart-and-checkout-blocks/checkout-payment-methods/filtering-payment-methods","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../block-development/cart-and-checkout-blocks/checkout-payment-methods/filtering-payment-methods.md","tags":[],"version":"current","frontMatter":{"post_title":"Filtering payment methods in the Checkout block","sidebar_label":"Filtering payment methods"},"sidebar":"docsSidebar","previous":{"title":"Checkout flow and events","permalink":"/docs/block-development/cart-and-checkout-blocks/checkout-payment-methods/checkout-flow-and-events"},"next":{"title":"Payment method integration","permalink":"/docs/block-development/cart-and-checkout-blocks/checkout-payment-methods/payment-method-integration"}}');var i=n(4848),a=n(8453);const s={post_title:"Filtering payment methods in the Checkout block",sidebar_label:"Filtering payment methods"},r="Filtering payment methods in the Checkout block",c={},l=[{value:"The problem",id:"the-problem",level:2},{value:"The solution",id:"the-solution",level:3},{value:"Importing",id:"importing",level:3},{value:"Aliased import",id:"aliased-import",level:4},{value:"<code>wc global</code>",id:"wc-global",level:4},{value:"Signature",id:"signature",level:3},{value:"Extension namespace collision",id:"extension-namespace-collision",level:4},{value:"Usage example",id:"usage-example",level:3},{value:"Callbacks registered for payment methods",id:"callbacks-registered-for-payment-methods",level:3},{value:"Filtering payment methods using requirements",id:"filtering-payment-methods-using-requirements",level:2},{value:"The problem",id:"the-problem-1",level:3},{value:"The solution",id:"the-solution-1",level:3},{value:"Basic usage",id:"basic-usage",level:3},{value:"Putting it all together",id:"putting-it-all-together",level:3}];function d(e){const t={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"filtering-payment-methods-in-the-checkout-block",children:"Filtering payment methods in the Checkout block"})}),"\n",(0,i.jsx)(t.h2,{id:"the-problem",children:"The problem"}),"\n",(0,i.jsx)(t.p,{children:"You're an extension developer, and your extension is conditionally hiding payment gateways on the checkout step. You need to be able to hide payment gateways on the Checkout block using a front-end extensibility point."}),"\n",(0,i.jsx)(t.h3,{id:"the-solution",children:"The solution"}),"\n",(0,i.jsxs)(t.p,{children:["WooCommerce Blocks provides a function called ",(0,i.jsx)(t.code,{children:"registerPaymentMethodExtensionCallbacks"})," which allows extensions to register callbacks for specific payment methods to determine if they can make payments."]}),"\n",(0,i.jsx)(t.h3,{id:"importing",children:"Importing"}),"\n",(0,i.jsx)(t.h4,{id:"aliased-import",children:"Aliased import"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"import { registerPaymentMethodExtensionCallbacks } from '@woocommerce/blocks-registry';\n"})}),"\n",(0,i.jsx)(t.h4,{id:"wc-global",children:(0,i.jsx)(t.code,{children:"wc global"})}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"const { registerPaymentMethodExtensionCallbacks } = window.wc.wcBlocksRegistry;\n"})}),"\n",(0,i.jsx)(t.h3,{id:"signature",children:"Signature"}),"\n",(0,i.jsxs)(t.table,{children:[(0,i.jsx)(t.thead,{children:(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.th,{children:"Parameter"}),(0,i.jsx)(t.th,{children:"Description"}),(0,i.jsx)(t.th,{children:"Type"})]})}),(0,i.jsxs)(t.tbody,{children:[(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"namespace"})}),(0,i.jsx)(t.td,{children:"Unique string to identify your extension. Choose something that eliminates a name collision with another extension."}),(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"string"})})]}),(0,i.jsxs)(t.tr,{children:[(0,i.jsx)(t.td,{children:(0,i.jsx)(t.code,{children:"callbacks"})}),(0,i.jsx)(t.td,{children:"An object containing callbacks registered for different payment methods"}),(0,i.jsx)(t.td,{children:"Record< string, CanMakePaymentExtensionCallback >"})]})]})]}),"\n",(0,i.jsxs)(t.p,{children:["Read more below about ",(0,i.jsx)(t.a,{href:"#callbacks-registered-for-payment-methods",children:"callbacks"}),"."]}),"\n",(0,i.jsx)(t.h4,{id:"extension-namespace-collision",children:"Extension namespace collision"}),"\n",(0,i.jsxs)(t.p,{children:["When trying to register callbacks under an extension namespace already used with ",(0,i.jsx)(t.code,{children:"registerPaymentMethodExtensionCallbacks"}),", the registration will be aborted and you will be notified that you are not using a unique namespace. This will be shown in the JavaScript console."]}),"\n",(0,i.jsx)(t.h3,{id:"usage-example",children:"Usage example"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-js",children:"registerPaymentMethodExtensionCallbacks( 'my-hypothetical-extension', {\n\tcod: ( arg ) => {\n\t\treturn arg.shippingAddress.city === 'Berlin';\n\t},\n\tcheque: ( arg ) => {\n\t\treturn false;\n\t},\n} );\n"})}),"\n",(0,i.jsx)(t.h3,{id:"callbacks-registered-for-payment-methods",children:"Callbacks registered for payment methods"}),"\n",(0,i.jsx)(t.p,{children:"Extensions can register only one callback per payment method:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-text",children:"payment_method_name: ( arg ) => {...}\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"payment_method_name"})," is the value of the ",(0,i.jsx)(t.a,{href:"payment-method-integration",children:"name"})," property used when the payment method was registered with WooCommerce Blocks."]}),"\n",(0,i.jsx)(t.p,{children:"The registered callbacks are used to determine whether the corresponding payment method should be available as an option for the shopper. The function will be passed an object containing data about the current order."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",children:"type CanMakePaymentExtensionCallback = (\n\tcartData: CanMakePaymentArgument\n) => boolean;\n"})}),"\n",(0,i.jsx)(t.p,{children:"Each callback will have access to the information bellow"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-ts",children:"interface CanMakePaymentArgument {\n\tcart: Cart;\n\tcartTotals: CartTotals;\n\tcartNeedsShipping: boolean;\n\tbillingAddress: CartResponseBillingAddress;\n\tshippingAddress: CartResponseShippingAddress;\n\tselectedShippingMethods: Record< string, unknown >;\n\tpaymentRequirements: Array< string >;\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:["If you need data that is not available in the parameter received by the callback you can consider ",(0,i.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/blob/trunk/plugins/woocommerce/client/blocks/docs/third-party-developers/extensibility/rest-api/extend-rest-api-add-data.md",children:"exposing your data in the Store API"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"filtering-payment-methods-using-requirements",children:"Filtering payment methods using requirements"}),"\n",(0,i.jsx)(t.h3,{id:"the-problem-1",children:"The problem"}),"\n",(0,i.jsx)(t.p,{children:"Your extension has added functionality to your store in such a way that only specific payment gateways can process orders that contain certain products."}),"\n",(0,i.jsxs)(t.p,{children:["Using the example of ",(0,i.jsx)(t.code,{children:"Bookings"})," if the shopper adds a ",(0,i.jsx)(t.code,{children:"Bookable"})," product to their cart, for example a stay in a hotel, and you, the merchant, want to confirm all bookings before taking payment. You would still need to capture the customer's checkout details but not their payment method at that point."]}),"\n",(0,i.jsx)(t.h3,{id:"the-solution-1",children:"The solution"}),"\n",(0,i.jsxs)(t.p,{children:["To allow the shopper to check out without entering payment details, but still require them to fill in the other checkout details it is possible to create a new payment method which will handle carts containing a ",(0,i.jsx)(t.code,{children:"Bookable"})," item."]}),"\n",(0,i.jsxs)(t.p,{children:["Using the ",(0,i.jsx)(t.code,{children:"supports"})," configuration of payment methods it is possible to prevent other payment methods (such as credit card, PayPal etc.) from being used to check out, and only allow the one your extension has added to appear in the Checkout block."]}),"\n",(0,i.jsxs)(t.p,{children:["For more information on how to register a payment method with WooCommerce Blocks, please refer to the ",(0,i.jsx)(t.a,{href:"/docs/block-development/cart-and-checkout-blocks/checkout-payment-methods/payment-method-integration",children:"Payment method integration"})," documentation."]}),"\n",(0,i.jsx)(t.h3,{id:"basic-usage",children:"Basic usage"}),"\n",(0,i.jsxs)(t.p,{children:["Following the documentation for registering payment methods linked above, you should register your payment method with a unique ",(0,i.jsx)(t.code,{children:"supports"})," feature, for example ",(0,i.jsx)(t.code,{children:"booking_availability"}),". This will be used to isolate it and prevent other methods from displaying."]}),"\n",(0,i.jsxs)(t.p,{children:["First you will need to create a function that will perform the checks on the cart to determine what the specific payment requirements of the cart are. Below is an example of doing this for our ",(0,i.jsx)(t.code,{children:"Bookable"})," products."]}),"\n",(0,i.jsxs)(t.p,{children:["Then you will need to use the ",(0,i.jsx)(t.code,{children:"register_payment_requirements"})," on the ",(0,i.jsx)(t.code,{children:"ExtendSchema"})," class to tell the Checkout block to execute a callback to check for requirements."]}),"\n",(0,i.jsx)(t.h3,{id:"putting-it-all-together",children:"Putting it all together"}),"\n",(0,i.jsxs)(t.p,{children:["This code example assumes there is some class called ",(0,i.jsx)(t.code,{children:"Pseudo_Booking_Class"})," that has the ",(0,i.jsx)(t.code,{children:"cart_contains_bookable_product"})," method available. The implementation of this method is not relevant here."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-php",children:"/**\n * Check the content of the cart and add required payment methods.\n *\n *\n * @return array list of features required by cart items.\n */\nfunction inject_payment_feature_requirements_for_cart_api() {\n  // Cart contains a bookable product, so return an array containing our requirement of booking_availability.\n  if ( Pseudo_Booking_Class::cart_contains_bookable_product() ) {\n    return array( 'booking_availability' );\n  }\n\n  // No bookable products in the cart, no need to add anything.\n  return array();\n}\n"})}),"\n",(0,i.jsxs)(t.p,{children:["To summarise the above: if there's a bookable product in the cart then this function will return an array containing ",(0,i.jsx)(t.code,{children:"booking_availability"}),", otherwise it will return an empty array."]}),"\n",(0,i.jsxs)(t.p,{children:["The next step will tell the ",(0,i.jsx)(t.code,{children:"ExtendSchema"})," class to execute this callback when checking which payment methods to display."]}),"\n",(0,i.jsx)(t.p,{children:"To do this you could use the following code:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-php",children:"add_action('woocommerce_blocks_loaded', function() {\n  woocommerce_store_api_register_payment_requirements(\n    array(\n      'data_callback' => 'inject_payment_feature_requirements_for_cart_api',\n    )\n  );\n});\n"})}),"\n",(0,i.jsxs)(t.p,{children:["It is important to note the comment in this code block, you must not instantiate your own version of ",(0,i.jsx)(t.code,{children:"ExtendSchema"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["If you've added your payment method correctly with the correct ",(0,i.jsx)(t.code,{children:"supports"})," values then when you reach the checkout page with a ",(0,i.jsx)(t.code,{children:"Bookable"})," item in your cart, any method that does not ",(0,i.jsx)(t.code,{children:"supports"})," the ",(0,i.jsx)(t.code,{children:"booking_availability"})," requirement should not display, while yours, the one that ",(0,i.jsx)(t.em,{children:"does"})," support this requirement ",(0,i.jsx)(t.em,{children:"will"})," display."]})]})}function h(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);