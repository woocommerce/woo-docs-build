"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[9615],{1685:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>l});const i=JSON.parse('{"id":"block-development/cart-and-checkout-blocks/integration-interface","title":"Handling scripts, styles, and data","description":"The problem","source":"@site/../block-development/cart-and-checkout-blocks/integration-interface.md","sourceDirName":"block-development/cart-and-checkout-blocks","slug":"/block-development/cart-and-checkout-blocks/integration-interface","permalink":"/docs/block-development/cart-and-checkout-blocks/integration-interface","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../block-development/cart-and-checkout-blocks/integration-interface.md","tags":[],"version":"current","frontMatter":{"post_title":"Handling scripts, styles, and data","sidebar_label":"Script, styles, and data handling"},"sidebar":"docsSidebar","previous":{"title":"Processing an order","permalink":"/docs/block-development/cart-and-checkout-blocks/how-checkout-processes-an-order"},"next":{"title":"Data flow overview","permalink":"/docs/block-development/cart-and-checkout-blocks/overview-of-data-flow"}}');var o=n(4848),s=n(8453);const r={post_title:"Handling scripts, styles, and data",sidebar_label:"Script, styles, and data handling"},a="Handling scripts, styles, and data",c={},l=[{value:"The problem",id:"the-problem",level:2},{value:"The solution",id:"the-solution",level:2},{value:"<code>IntegrationInterface</code> methods",id:"integrationinterface-methods",level:2},{value:"<code>get_name()</code>",id:"get_name",level:3},{value:"<code>initialize()</code>",id:"initialize",level:3},{value:"<code>get_script_handles()</code>",id:"get_script_handles",level:3},{value:"<code>get_editor_script_handles()</code>",id:"get_editor_script_handles",level:3},{value:"<code>get_script_data()</code>",id:"get_script_data",level:3},{value:"Usage example",id:"usage-example",level:2},{value:"Getting data added in <code>get_script_data</code>",id:"getting-data-added-in-get_script_data",level:3}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"handling-scripts-styles-and-data",children:"Handling scripts, styles, and data"})}),"\n",(0,o.jsx)(t.h2,{id:"the-problem",children:"The problem"}),"\n",(0,o.jsx)(t.p,{children:"You are an extension developer, and to allow users to interact with your extension on the client-side, you have written some CSS and JavaScript that you would like to be included on the page. Your JavaScript also relies on some server-side data, and you'd like this to be available to your scripts."}),"\n",(0,o.jsx)(t.h2,{id:"the-solution",children:"The solution"}),"\n",(0,o.jsxs)(t.p,{children:["You may use the ",(0,o.jsx)(t.code,{children:"IntegrationRegistry"})," to register an ",(0,o.jsx)(t.code,{children:"IntegrationInterface"})," this will be a class that will handle the enqueuing of scripts, styles, and data. You may have a different ",(0,o.jsx)(t.code,{children:"IntegrationInterface"})," for each block (Mini-Cart, Cart and Checkout), or you may use the same one, it is entirely dependent on your use case."]}),"\n",(0,o.jsxs)(t.p,{children:["You should use the hooks: ",(0,o.jsx)(t.code,{children:"woocommerce_blocks_mini-cart_block_registration"}),". ",(0,o.jsx)(t.code,{children:"woocommerce_blocks_cart_block_registration"})," and ",(0,o.jsx)(t.code,{children:"woocommerce_blocks_checkout_block_registration"}),". These hooks pass an instance of ",(0,o.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce-gutenberg-products-block/blob/trunk/src/Integrations/IntegrationRegistry.php",children:(0,o.jsx)(t.code,{children:"IntegrationRegistry"})})," to the callback."]}),"\n",(0,o.jsxs)(t.p,{children:["You may then use the ",(0,o.jsx)(t.code,{children:"register"})," method on this object to register your ",(0,o.jsx)(t.code,{children:"IntegrationInterface"}),"."]}),"\n",(0,o.jsxs)(t.h2,{id:"integrationinterface-methods",children:[(0,o.jsx)(t.code,{children:"IntegrationInterface"})," methods"]}),"\n",(0,o.jsxs)(t.p,{children:["To begin, we'll need to create our integration class, our ",(0,o.jsx)(t.code,{children:"IntegrationInterface"}),". This will be a class that implements WooCommerce Blocks' interface named ",(0,o.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce-gutenberg-products-block/blob/trunk/src/Integrations/IntegrationInterface.php",children:(0,o.jsx)(t.code,{children:"IntegrationInterface"})}),"."]}),"\n",(0,o.jsx)(t.p,{children:"In this section, we will step through the interface's members and discuss what they are used for."}),"\n",(0,o.jsx)(t.h3,{id:"get_name",children:(0,o.jsx)(t.code,{children:"get_name()"})}),"\n",(0,o.jsxs)(t.p,{children:["This is the ",(0,o.jsx)(t.code,{children:"IntegrationInterface"}),"'s way of namespacing your integration. The name chosen here should be unique to your extension. This method should return a string."]}),"\n",(0,o.jsx)(t.h3,{id:"initialize",children:(0,o.jsx)(t.code,{children:"initialize()"})}),"\n",(0,o.jsx)(t.p,{children:"This is where any setup, or initialization for your integration should be placed. For example, you could register the scripts and styles your extension needs here. This method should not return anything."}),"\n",(0,o.jsx)(t.h3,{id:"get_script_handles",children:(0,o.jsx)(t.code,{children:"get_script_handles()"})}),"\n",(0,o.jsx)(t.p,{children:"This is where the handles of any scripts you want to be enqueued on the client-side in the frontend context should be placed. This method should return an array of strings."}),"\n",(0,o.jsx)(t.h3,{id:"get_editor_script_handles",children:(0,o.jsx)(t.code,{children:"get_editor_script_handles()"})}),"\n",(0,o.jsx)(t.p,{children:"This is where the handles of any scripts you want to be enqueued on the client-side in the editor context should be placed. This method should return an array of strings."}),"\n",(0,o.jsx)(t.h3,{id:"get_script_data",children:(0,o.jsx)(t.code,{children:"get_script_data()"})}),"\n",(0,o.jsxs)(t.p,{children:["This is where you can set values you want to be available to your scripts on the frontend. This method should return an associative array, the keys of which will be used to get the data using the JavaScript function ",(0,o.jsx)(t.code,{children:"getSetting"}),"."]}),"\n",(0,o.jsx)(t.p,{children:"The keys and values of this array should all be serializable."}),"\n",(0,o.jsx)(t.h2,{id:"usage-example",children:"Usage example"}),"\n",(0,o.jsxs)(t.p,{children:["Let's suppose we're the author of an extension: ",(0,o.jsx)(t.code,{children:"WooCommerce Example Plugin"}),". We want to enqueue scripts, styles, and data on the frontend when either the Mini-Cart, Cart or Checkout blocks are being used."]}),"\n",(0,o.jsx)(t.p,{children:"We also want some data from a server-side function to be available to our front-end scripts."}),"\n",(0,o.jsxs)(t.p,{children:["You will notice that in the example below, we reference the ",(0,o.jsx)(t.code,{children:"/build/index.asset.php"})," file. This is created by the ",(0,o.jsx)(t.a,{href:"https://www.npmjs.com/package/@wordpress/dependency-extraction-webpack-plugin",children:(0,o.jsx)(t.code,{children:"DependencyExtractionWebpackPlugin"})})," which creates a PHP file mapping the dependencies of your client-side scripts, so that they can be added in the ",(0,o.jsx)(t.code,{children:"dependencies"})," array of ",(0,o.jsx)(t.code,{children:"wp_register_script"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["Let's create our ",(0,o.jsx)(t.code,{children:"IntegrationInterface"}),"."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"<?php\nuse Automattic\\WooCommerce\\Blocks\\Integrations\\IntegrationInterface;\n\n/**\n * Class for integrating with WooCommerce Blocks\n */\nclass WooCommerce_Example_Plugin_Integration implements IntegrationInterface {\n\t/**\n\t * The name of the integration.\n\t *\n\t * @return string\n\t */\n\tpublic function get_name() {\n\t\treturn 'woocommerce-example-plugin';\n\t}\n\n\t/**\n\t * When called invokes any initialization/setup for the integration.\n\t */\n\tpublic function initialize() {\n\t\t$script_path = '/build/index.js';\n\t\t$style_path = '/build/style-index.css';\n\n    /**\n     * The assets linked below should be a path to a file, for the sake of brevity\n     * we will assume \\WooCommerce_Example_Plugin_Assets::$plugin_file is a valid file path\n    */\n\t\t$script_url = plugins_url( $script_path, \\WooCommerce_Example_Plugin_Assets::$plugin_file );\n\t\t$style_url = plugins_url( $style_path, \\WooCommerce_Example_Plugin_Assets::$plugin_file );\n\n\t\t$script_asset_path = dirname( \\WooCommerce_Example_Plugin_Assets::$plugin_file ) . '/build/index.asset.php';\n\t\t$script_asset      = file_exists( $script_asset_path )\n\t\t\t? require $script_asset_path\n\t\t\t: array(\n\t\t\t\t'dependencies' => array(),\n\t\t\t\t'version'      => $this->get_file_version( $script_path ),\n\t\t\t);\n\n\t\twp_enqueue_style(\n\t\t\t'wc-blocks-integration',\n\t\t\t$style_url,\n\t\t\t[],\n\t\t\t$this->get_file_version( $style_path )\n\t\t);\n\n\t\twp_register_script(\n\t\t\t'wc-blocks-integration',\n\t\t\t$script_url,\n\t\t\t$script_asset['dependencies'],\n\t\t\t$script_asset['version'],\n\t\t\ttrue\n\t\t);\n\t\twp_set_script_translations(\n\t\t\t'wc-blocks-integration',\n\t\t\t'woocommerce-example-plugin',\n\t\t\tdirname( \\WooCommerce_Example_Plugin_Assets::$plugin_file ) . '/languages'\n\t\t);\n\t}\n\n\t/**\n\t * Returns an array of script handles to enqueue in the frontend context.\n\t *\n\t * @return string[]\n\t */\n\tpublic function get_script_handles() {\n\t\treturn array( 'wc-blocks-integration' );\n\t}\n\n\t/**\n\t * Returns an array of script handles to enqueue in the editor context.\n\t *\n\t * @return string[]\n\t */\n\tpublic function get_editor_script_handles() {\n\t\treturn array( 'wc-blocks-integration' );\n\t}\n\n\t/**\n\t * An array of key, value pairs of data made available to the block on the client side.\n\t *\n\t * @return array\n\t */\n\tpublic function get_script_data() {\n\t    $woocommerce_example_plugin_data = some_expensive_serverside_function();\n\t    return [\n\t        'expensive_data_calculation' => $woocommerce_example_plugin_data\n        ];\n\t}\n\n\t/**\n\t * Get the file modified time as a cache buster if we're in dev mode.\n\t *\n\t * @param string $file Local path to the file.\n\t * @return string The cache buster value to use for the given file.\n\t */\n\tprotected function get_file_version( $file ) {\n\t\tif ( defined( 'SCRIPT_DEBUG' ) && SCRIPT_DEBUG && file_exists( $file ) ) {\n\t\t\treturn filemtime( $file );\n\t\t}\n\n\t\t// As above, let's assume that WooCommerce_Example_Plugin_Assets::VERSION resolves to some versioning number our\n\t\t// extension uses.\n\t\treturn \\WooCommerce_Example_Plugin_Assets::VERSION;\n\t}\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["As mentioned, we will need register our ",(0,o.jsx)(t.code,{children:"IntegrationInterface"})," with WooCommerce Blocks, as we want our scripts to be included when either the Mini-Cart, Cart or Checkout is used, we need to register callbacks for three actions."]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-php",children:"add_action(\n    'woocommerce_blocks_mini-cart_block_registration',\n    function( $integration_registry ) {\n        $integration_registry->register( new WooCommerce_Example_Plugin_Integration() );\n    }\n);\nadd_action(\n    'woocommerce_blocks_cart_block_registration',\n    function( $integration_registry ) {\n        $integration_registry->register( new WooCommerce_Example_Plugin_Integration() );\n    }\n);\nadd_action(\n    'woocommerce_blocks_checkout_block_registration',\n    function( $integration_registry ) {\n        $integration_registry->register( new WooCommerce_Example_Plugin_Integration() );\n    }\n);\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Now, when we load a page containing either block, we should see the scripts we registered in ",(0,o.jsx)(t.code,{children:"initialize"})," being loaded!"]}),"\n",(0,o.jsxs)(t.h3,{id:"getting-data-added-in-get_script_data",children:["Getting data added in ",(0,o.jsx)(t.code,{children:"get_script_data"})]}),"\n",(0,o.jsxs)(t.p,{children:["We associated some data with the extension in the ",(0,o.jsx)(t.code,{children:"get_script_data"})," method of our interface, we need to know how to get this!"]}),"\n",(0,o.jsxs)(t.p,{children:["In the ",(0,o.jsx)(t.code,{children:"@woocommerce/settings"})," package there is a method you can import called ",(0,o.jsx)(t.code,{children:"getSetting"}),". This method accepts a string. The name of the setting containing the data added in ",(0,o.jsx)(t.code,{children:"get_script_data"})," is the name of your integration (i.e. the value returned by ",(0,o.jsx)(t.code,{children:"get_name"}),") suffixed with ",(0,o.jsx)(t.code,{children:"_data"}),". In our example it would be: ",(0,o.jsx)(t.code,{children:"woocommerce-example-plugin_data"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["The value returned here is a plain old JavaScript object, keyed by the keys of the array returned by ",(0,o.jsx)(t.code,{children:"get_script_data"}),", the values will serialized."]})]})}function h(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>r,x:()=>a});var i=n(6540);const o={},s=i.createContext(o);function r(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);