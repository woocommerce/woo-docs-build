"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[8510],{4269:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"features/high-performance-order-storage/cli-tools","title":"HPOS CLI Tools","description":"Overview","source":"@site/../features/high-performance-order-storage/cli-tools.md","sourceDirName":"features/high-performance-order-storage","slug":"/features/high-performance-order-storage/cli-tools","permalink":"/docs/features/high-performance-order-storage/cli-tools","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../features/high-performance-order-storage/cli-tools.md","tags":[],"version":"current","frontMatter":{"post_title":"HPOS CLI Tools"},"sidebar":"docsSidebar","previous":{"title":"High Performance Order Storage","permalink":"/docs/features/high-performance-order-storage/"},"next":{"title":"Enable HPOS","permalink":"/docs/features/high-performance-order-storage/enable-hpos"}}');var r=s(4848),a=s(8453);const i={post_title:"HPOS CLI Tools"},t="HPOS CLI Tools",d={},l=[{value:"Overview",id:"overview",level:2},{value:"Usage and examples",id:"usage-and-examples",level:2},{value:"<code>wc hpos status</code>",id:"wc-hpos-status",level:3},{value:"Example 1 - HPOS status output",id:"example-1---hpos-status-output",level:4},{value:"<code>wc hpos enable</code>",id:"wc-hpos-enable",level:3},{value:"Example 1 - Enable HPOS via CLI",id:"example-1---enable-hpos-via-cli",level:4},{value:"<code>wc hpos disable</code>",id:"wc-hpos-disable",level:3},{value:"Example 1 - Attempt to disable HPOS (with orders pending sync)",id:"example-1---attempt-to-disable-hpos-with-orders-pending-sync",level:4},{value:"Example 2 - Disable HPOS",id:"example-2---disable-hpos",level:4},{value:"<code>wc hpos count_unmigrated</code>",id:"wc-hpos-count_unmigrated",level:3},{value:"Example 1 - Obtain number of orders pending sync",id:"example-1---obtain-number-of-orders-pending-sync",level:4},{value:"<code>wc hpos sync</code>",id:"wc-hpos-sync",level:3},{value:"Example 1 - Sync all orders",id:"example-1---sync-all-orders",level:4},{value:"<code>wc hpos verify_data</code>",id:"wc-hpos-verify_data",level:3},{value:"Example 1 - Verify data on a migrated site",id:"example-1---verify-data-on-a-migrated-site",level:4},{value:"Example 2 - Verification failures",id:"example-2---verification-failures",level:4},{value:"Example 3 - Re-migrate during verification",id:"example-3---re-migrate-during-verification",level:4},{value:"<code>wc hpos diff</code>",id:"wc-hpos-diff",level:3},{value:"Example 1 - No difference between orders",id:"example-1---no-difference-between-orders",level:4},{value:"Example 2 - Mismatch in order properties between datastores",id:"example-2---mismatch-in-order-properties-between-datastores",level:4},{value:"Example 3 - JSON output",id:"example-3---json-output",level:4},{value:"<code>wc hpos backfill</code>",id:"wc-hpos-backfill",level:3},{value:"Example 1 - Migrate a full order from HPOS to posts",id:"example-1---migrate-a-full-order-from-hpos-to-posts",level:4},{value:"Example 2 - Migrate metadata",id:"example-2---migrate-metadata",level:4},{value:"Example 3",id:"example-3",level:4},{value:"<code>wc hpos cleanup</code>",id:"wc-hpos-cleanup",level:3},{value:"Example 1 - Error during cleanup",id:"example-1---error-during-cleanup",level:4},{value:"Example 2 - Cleaning up a range of order IDs",id:"example-2---cleaning-up-a-range-of-order-ids",level:4},{value:"Example 3 -Cleaning up all orders",id:"example-3--cleaning-up-all-orders",level:4}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"hpos-cli-tools",children:"HPOS CLI Tools"})}),"\n",(0,r.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsxs)(n.p,{children:["We have a number of ",(0,r.jsx)(n.a,{href:"https://developer.woocommerce.com/docs/category/wc-cli/",children:"WP-CLI commands"})," that can be used to manage HPOS-related functionality, all of which live under the ",(0,r.jsx)(n.code,{children:"wp wc hpos"})," namespace (though you may come across blog posts and older documentation referencing the now-deprecated ",(0,r.jsx)(n.code,{children:"wp wc cot"})," namespace)."]}),"\n",(0,r.jsx)(n.p,{children:"The following table provides an overview of what each command does, while more details and examples can be found below."}),"\n",(0,r.jsxs)(n.p,{children:["Keep in mind that the commands themselves have documentation and examples that can be accessed via WP-CLI's help by passing the ",(0,r.jsx)(n.code,{children:"--help"})," flag."]}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Command"}),(0,r.jsx)(n.th,{children:"Use this command to..."})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos status"})}),(0,r.jsx)(n.td,{children:"Get an overview of all HPOS matters on your site."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos enable"})}),(0,r.jsx)(n.td,{children:"Enable HPOS (and possibly compatibility mode)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos disable"})}),(0,r.jsx)(n.td,{children:"Disable HPOS (and possibly compatibility mode)."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos count_unmigrated"})}),(0,r.jsx)(n.td,{children:"Get a count of all orders pending sync."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos sync"})}),(0,r.jsx)(n.td,{children:"Performantly sync orders from the currently active order storage to the other."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos verify_data"})}),(0,r.jsx)(n.td,{children:"Verify data between datastores."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos diff"})}),(0,r.jsx)(n.td,{children:"Get an user friendly version of the differences for an order between both order storages."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos backfill"})}),(0,r.jsx)(n.td,{children:"Copy over whole orders or specific bits of order data from any order storage to the other."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"wc hpos cleanup"})}),(0,r.jsx)(n.td,{children:"Remove order data from legacy tables."})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"usage-and-examples",children:"Usage and examples"}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-status",children:(0,r.jsx)(n.code,{children:"wc hpos status"})}),"\n",(0,r.jsx)(n.p,{children:"Use this to get an overview of HPOS settings and status on your site. The command will output whether HPOS and compatibility mode are enabled or not, and other useful information such as orders pending sync or subject to cleanup."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," Remember that, if desired, orders pending sync can be synced using ",(0,r.jsx)(n.a,{href:"#wc-hpos-sync",children:(0,r.jsx)(n.code,{children:"wc hpos sync"})})," and, similarly, you can perform a cleanup on those subject to cleanup (provided compatibility mode is disabled) by running ",(0,r.jsx)(n.a,{href:"#wc-hpos-cleanup",children:(0,r.jsx)(n.code,{children:"wc hpos cleanup all"})}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---hpos-status-output",children:"Example 1 - HPOS status output"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos status\nHPOS enabled?: yes\nCompatibility mode enabled?: no\nUnsynced orders: 651\nOrders subject to cleanup: 348\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-enable",children:(0,r.jsx)(n.code,{children:"wc hpos enable"})}),"\n",(0,r.jsx)(n.p,{children:"Use this command to enable HPOS and compatibility mode (if desired) from the command line."}),"\n",(0,r.jsx)(n.h4,{id:"example-1---enable-hpos-via-cli",children:"Example 1 - Enable HPOS via CLI"}),"\n",(0,r.jsxs)(n.p,{children:["Enables HPOS and compatibility mode too (",(0,r.jsx)(n.code,{children:"--with-sync"})," flag)."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos enable --with-sync\nRunning pre-enable checks...\nSuccess: Sync enabled.\nSuccess: HPOS enabled.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-disable",children:(0,r.jsx)(n.code,{children:"wc hpos disable"})}),"\n",(0,r.jsx)(n.p,{children:"Similarly to the prior command, this can be used to disable HPOS."}),"\n",(0,r.jsx)(n.h4,{id:"example-1---attempt-to-disable-hpos-with-orders-pending-sync",children:"Example 1 - Attempt to disable HPOS (with orders pending sync)"}),"\n",(0,r.jsxs)(n.p,{children:["If there are any orders pending sync, you won't be allowed to disable HPOS until those orders have been synced (via ",(0,r.jsx)(n.code,{children:"wp wc hpos sync"}),")."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos disable\nRunning pre-disable checks...\nError: [Failed] There are orders pending sync. Please run `wp wc hpos sync` to sync pending orders.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-2---disable-hpos",children:"Example 2 - Disable HPOS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos disable\nRunning pre-disable checks...\nSuccess: HPOS disabled.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-count_unmigrated",children:(0,r.jsx)(n.code,{children:"wc hpos count_unmigrated"})}),"\n",(0,r.jsx)(n.p,{children:"Prints the number of orders pending sync."}),"\n",(0,r.jsx)(n.h4,{id:"example-1---obtain-number-of-orders-pending-sync",children:"Example 1 - Obtain number of orders pending sync"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos count_unmigrated\nThere are 651 orders to be synced.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-sync",children:(0,r.jsx)(n.code,{children:"wc hpos sync"})}),"\n",(0,r.jsx)(n.p,{children:"This command can be used to migrate orders from the posts order storage to HPOS (or viceversa) based on the current settings in WC > Settings > Advanced > Features.\nThat is, it'll sync orders from your currently selected datastore to the other one."}),"\n",(0,r.jsx)(n.p,{children:"Note that enabling compatibility mode in the settings will eventually take care of migrating all orders, but this command can be used to do that more performantly."}),"\n",(0,r.jsxs)(n.p,{children:["If you need more control over which datastore to use as source (or destination) regardless of settings, or want to migrate just a few orders or properties, use ",(0,r.jsx)(n.a,{href:"#wc-hpos-backfill",children:(0,r.jsx)(n.code,{children:"wp wc hpos backfill"})})," instead."]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---sync-all-orders",children:"Example 1 - Sync all orders"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos sync\nThere are 999 orders to be synced.\nOrder Data Sync  100% [============================================================================================] 0:08 / 0:08\nSync completed.\nSuccess: 999 orders were synced in 14 seconds.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-verify_data",children:(0,r.jsx)(n.code,{children:"wc hpos verify_data"})}),"\n",(0,r.jsx)(n.p,{children:'Use this command to check that order data in both the legacy (posts) datastore and HPOS is in sync. This is only relevant if you have "compatibility mode" enabled and orders might\'ve been modified outside of the usual WooCommerce flows.'}),"\n",(0,r.jsxs)(n.p,{children:["This command operates on all orders. For a user friendlier alternative that operates on individual orders, refer to ",(0,r.jsx)(n.a,{href:"#wc-hpos-diff",children:(0,r.jsx)(n.code,{children:"wp wc hpos diff"})}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---verify-data-on-a-migrated-site",children:"Example 1 - Verify data on a migrated site"}),"\n",(0,r.jsx)(n.p,{children:"All orders are identical between datastores."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos verify_data\nOrder Data Verification  100% [====================================================================================] 0:00 / 0:00\nVerification completed.\nSuccess: 999 orders were verified in 0 seconds.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-2---verification-failures",children:"Example 2 - Verification failures"}),"\n",(0,r.jsx)(n.p,{children:"An order (with ID 100126) fails verification due to differences in order total, tax, modification date and billing information."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'$ wp wc hpos verify_data\nOrder Data Verification  100% [====================================================================================] 0:00 / 0:00\nVerification completed.\nError: 999 orders were verified in 0 seconds. 1 error found: {\n    "100126": [\n        {\n            "column": "post_modified_gmt",\n            "original_value": "2024-04-04 15:32:27",\n            "new_value": "2024-04-05 15:19:56"\n        },\n        {\n            "column": "_order_tax",\n            "original_value": "74",\n            "new_value": "0"\n        },\n        {\n            "column": "_order_total",\n            "original_value": "567.25",\n            "new_value": "0"\n        },\n        {\n            "order_id": 100126,\n            "meta_key": "_billing_address_index",\n            "orig_meta_values": [\n                "Hans Howell Moore Ltd 325 Ross Drive  Wilfridhaven WA 23322 NF heidi.koch@example.net +17269674166"\n            ],\n            "new_meta_values": [\n                "Hans X Howell Moore Ltd 325 Ross Drive  Wilfridhaven WA 23322 NF heidi.koch@example.net +17269674166"\n            ]\n        }\n    ]\n}. Please review the error above.\n'})}),"\n",(0,r.jsx)(n.h4,{id:"example-3---re-migrate-during-verification",children:"Example 3 - Re-migrate during verification"}),"\n",(0,r.jsxs)(n.p,{children:["The verification command also admits a ",(0,r.jsx)(n.code,{children:"--re-migrate"})," flag that will attempt to sync orders that have differences. This could effectively overwrite an order in the database, so use with care."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos verify_data --re-migrate\nOrder Data Verification  100% [====================================================================================] 0:00 / 0:00\nVerification completed.\nSuccess: 999 orders were verified in 0 seconds.\n"})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-diff",children:(0,r.jsx)(n.code,{children:"wc hpos diff"})}),"\n",(0,r.jsxs)(n.p,{children:["If you have enabled compatibility mode or migrated orders using ",(0,r.jsx)(n.code,{children:"wp wc hpos sync"}),", all of your orders should be in an identical state in both datastores (the legacy one and HPOS), but errors can happen. Also, manually modifying orders in the database or use of HPOS-incompatible plugins can result in orders deviating."]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"wp wc hpos diff"}),"  tool can be used to look into those (possible) differences, which can be useful to determine whether re-migrating to/from either datastore should be done, or a more careful approach needs to be taken."]}),"\n",(0,r.jsxs)(n.p,{children:["The tool itself doesn't reconcile the differences. For that you should use ",(0,r.jsx)(n.a,{href:"#wc-hpos-backfill",children:(0,r.jsx)(n.code,{children:"wp wc hpos backfill"})}),"."]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---no-difference-between-orders",children:"Example 1 - No difference between orders"}),"\n",(0,r.jsx)(n.p,{children:"Order is the same in both datastores (legacy and HPOS)."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos diff 100087\nSuccess: No differences found.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-2---mismatch-in-order-properties-between-datastores",children:"Example 2 - Mismatch in order properties between datastores"}),"\n",(0,r.jsxs)(n.p,{children:["This examples shows that order ",(0,r.jsx)(n.code,{children:"100126"}),"  differs in various fields between both datastores. For example, its HPOS version has status ",(0,r.jsx)(n.code,{children:"completed"})," while the post is still in ",(0,r.jsx)(n.code,{children:"pending"})," status. Similarly, there are differences in other fields and there's even some metadata (",(0,r.jsx)(n.code,{children:"post_only_meta"}),") that only exists in the post/legacy version."]}),"\n",(0,r.jsx)(n.p,{children:"Any other order fields or metadata not listed are understood to be equal in both order versions."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos diff 100126\nWarning: Differences found for order 100126:\n+--------------------+---------------------------+---------------------------+\n| property           | hpos                      | post                      |\n+--------------------+---------------------------+---------------------------+\n| status             | completed                 | pending                   |\n| total              | 567.25                    | 267.25                    |\n| date_modified      | 2024-04-04T15:32:27+00:00 | 2024-04-04T19:00:26+00:00 |\n| billing_first_name | Hans                      | Jans                      |\n| post_only_meta     |                           | why not?                  |\n+--------------------+---------------------------+---------------------------+\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-3---json-output",children:"Example 3 - JSON output"}),"\n",(0,r.jsxs)(n.p,{children:["You can also get the output in various formats (",(0,r.jsx)(n.code,{children:"json"}),", ",(0,r.jsx)(n.code,{children:"csv"})," or ",(0,r.jsx)(n.code,{children:"list"})," -the default-), which can be useful for exporting differences from various orders to a file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:'$ wp wc hpos diff 100126 --format=json\nWarning: Differences found for order 100126:\n[{"property":"status","hpos":"completed","post":"pending"},{"property":"total","hpos":"567.25","post":"267.25"},{"property":"date_modified","hpos":"2024-04-04T15:32:27+00:00","post":"2024-04-04T19:00:26+00:00"},{"property":"billing_first_name","hpos":"Hans","post":"Jans"},{"property":"post_only_meta","hpos":"","post":"why not?"}]\n'})}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-backfill",children:(0,r.jsx)(n.code,{children:"wc hpos backfill"})}),"\n",(0,r.jsx)(n.p,{children:"The backfill command can be used to selectively migrate order data (or whole orders) from either the legacy or HPOS datastore to the other one. It's very useful to reconcile sync or migration mishaps."}),"\n",(0,r.jsx)(n.p,{children:"The exact syntax for this command is as follows:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"wp wc hpos backfill <order_id> --from=<datastore> --to=<datastore> [--meta_keys=<meta_keys>] [--props=<props>]\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You have to specify which datastore to use as source (either ",(0,r.jsx)(n.code,{children:"posts"})," or ",(0,r.jsx)(n.code,{children:"hpos"}),") and which one to use as destination. The ",(0,r.jsx)(n.code,{children:"--meta_keys"})," and ",(0,r.jsx)(n.code,{children:"--props"})," arguments receive a comma separated list of meta keys and order properties, which can be used to move only certain data from one datastore to the other, instead of the whole order."]}),"\n",(0,r.jsxs)(n.p,{children:["Note that ",(0,r.jsx)(n.code,{children:"wp wc hpos backfill"})," differs from ",(0,r.jsx)(n.code,{children:"wp wc hpos sync"})," in various ways:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"You can specify which order to operate on, which gives you more control for one-off operations."}),"\n",(0,r.jsxs)(n.li,{children:["It lets you move order data between datastores irrespective of what the current order storage is in WC settings. In contrast, ",(0,r.jsx)(n.code,{children:"wp wc hpos sync"})," will only sync data from the current datastore to the other."]}),"\n",(0,r.jsx)(n.li,{children:"In addition to letting you migrate full orders, it lets you choose which bits of data (order fields or metadata) to migrate."}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---migrate-a-full-order-from-hpos-to-posts",children:"Example 1 - Migrate a full order from HPOS to posts"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos backfill 99709\nSuccess: Order 99709 backfilled from hpos to posts.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-2---migrate-metadata",children:"Example 2 - Migrate metadata"}),"\n",(0,r.jsx)(n.p,{children:"Continuing with example 2 from the previous section, we can see how to migrate just one key of metadata from posts to HPOS."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos backfill 100126 --from=posts --to=hpos --meta_keys=post_only_meta\nSuccess: Order 100126 backfilled from posts to hpos.\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If you now run ",(0,r.jsx)(n.code,{children:"wp wc hpos diff"})," on this order, you can see that the bit of metadata is no longer listed as a difference."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos diff 100126\nWarning: Differences found for order 100126:\n+--------------------+---------------------------+---------------------------+\n| property           | hpos                      | post                      |\n+--------------------+---------------------------+---------------------------+\n| status             | completed                 | pending                   |\n| total              | 567.25                    | 267.25                    |\n| date_modified      | 2024-04-04T15:32:27+00:00 | 2024-04-04T19:00:26+00:00 |\n| billing_first_name | Hans                      | Jans                      |\n+--------------------+---------------------------+---------------------------+\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-3",children:"Example 3"}),"\n",(0,r.jsxs)(n.p,{children:["Also following the previous example, we can now reconcile all the data as we see fit. For example, we can migrate the status from posts to HPOS and the other bits of info in the other direction.\nIn the end, the orders will be identical, as can be confirmed through ",(0,r.jsx)(n.code,{children:"wp wc hpos diff"}),"."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:'Sync order status from posts to HPOS. This means the order will become "pending" in both datastores.'}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos backfill 100126 --from=posts --to=hpos --props=status\nSuccess: Order 100126 backfilled from posts to hpos.\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Sync the other properties from HPOS to posts."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos backfill 100126 --from=hpos --to=posts --props=total,date_modified,billing_first_name\nSuccess: Order 100126 backfilled from hpos to posts.\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Are we all sync'ed yet?"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos diff 100126\nSuccess: No differences found.\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"wc-hpos-cleanup",children:(0,r.jsx)(n.code,{children:"wc hpos cleanup"})}),"\n",(0,r.jsx)(n.p,{children:"The cleanup command can be used to remove order data from legacy tables when HPOS is enabled and compatibility mode is disabled."}),"\n",(0,r.jsxs)(n.p,{children:["Given this is a destructive operation, the tool won't do anything by default. You'll have to specify an order ID, a range of order IDs or ",(0,r.jsx)(n.code,{children:"all"})," to operate on all orders."]}),"\n",(0,r.jsxs)(n.p,{children:["The tool will also verify orders before removal, stopping if the post version seems more recent than the HPOS one. This allows closer inspection of those differences (for example, with ",(0,r.jsx)(n.code,{children:"wp wc hpos diff"}),") and reconciling the data (with ",(0,r.jsx)(n.a,{href:"#wc-hpos-backfill",children:(0,r.jsx)(n.code,{children:"wp wc hpos backfill"})}),") before the deletion is executed."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This command won't remove placeholder records (posts with type ",(0,r.jsx)(n.code,{children:"shop_order_placehold"}),") from the posts table. We're working on allowing this in the near future, but for now leave placeholders so that datastores can be switched if necessary. Metadata is removed, which is where most data is stored in the legacy order storage, so the remaining placeholder post is very lightweight."]}),"\n",(0,r.jsx)(n.h4,{id:"example-1---error-during-cleanup",children:"Example 1 - Error during cleanup"}),"\n",(0,r.jsx)(n.p,{children:"Cleaning up of an order that seems more recent on the posts datastore is prevented by default."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos cleanup 100126\nStarting cleanup for 1 order...\nWarning: An error occurred while cleaning up order 100126: Data in posts table appears to be more recent than in HPOS tables.\n"})}),"\n",(0,r.jsxs)(n.p,{children:["You can investigate the differences with ",(0,r.jsx)(n.code,{children:"wp wc hpos diff"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos diff 100126\nWarning: Differences found for order 100126:\n+---------------+---------------------------+---------------------------+\n| property      | hpos                      | post                      |\n+---------------+---------------------------+---------------------------+\n| date_modified | 2024-04-05T15:19:56+00:00 | 2024-04-05T16:39:26+00:00 |\n+---------------+---------------------------+---------------------------+\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If reconciling is not necessary, the ",(0,r.jsx)(n.code,{children:"--force"})," flag can be used to skip the verification checks:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext\x1b",children:"$ wp wc hpos cleanup 100126 --force\nStarting cleanup for 1 order...\nHPOS cleanup  100% [=====================================================================================================================] 0:00 / 0:00\nSuccess: Cleanup completed for 1 order.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-2---cleaning-up-a-range-of-order-ids",children:"Example 2 - Cleaning up a range of order IDs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos cleanup 90000-100000\nStarting cleanup for 865 orders...\nHPOS cleanup  100% [=====================================================================================================================] 0:01 / 0:12\nSuccess: Cleanup completed for 865 orders.\n"})}),"\n",(0,r.jsx)(n.h4,{id:"example-3--cleaning-up-all-orders",children:"Example 3 -Cleaning up all orders"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-plaintext",children:"$ wp wc hpos cleanup all\nStarting cleanup for 999 orders...\nHPOS cleanup  100% [=====================================================================================================================] 0:01 / 0:05\nSuccess: Cleanup completed for 999 orders.\n"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>t});var o=s(6540);const r={},a=o.createContext(r);function i(e){const n=o.useContext(a);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);