"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[9107],{8275:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>d,default:()=>u,frontMatter:()=>s,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"block-development/product-editor-development/how-to-guides/custom-field-tutorial","title":"Extending the product form with custom fields","description":"Aside from extending the product form using generic fields it is also possible to use custom fields. This does require knowledge of JavaScript and React.","source":"@site/../block-development/product-editor-development/how-to-guides/custom-field-tutorial.md","sourceDirName":"block-development/product-editor-development/how-to-guides","slug":"/block-development/product-editor-development/how-to-guides/custom-field-tutorial","permalink":"/docs/block-development/product-editor-development/how-to-guides/custom-field-tutorial","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../block-development/product-editor-development/how-to-guides/custom-field-tutorial.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"How-to Guides for the Product form","permalink":"/docs/block-development/product-editor-development/how-to-guides/"},"next":{"title":"Extending the product form with generic fields","permalink":"/docs/block-development/product-editor-development/how-to-guides/generic-fields-tutorial"}}');var i=o(4848),r=o(8453);const s={},d="Extending the product form with custom fields",l={},c=[{value:"Getting started",id:"getting-started",level:2},{value:"Creating a custom field",id:"creating-a-custom-field",level:2},{value:"Adding and registering our custom field",id:"adding-and-registering-our-custom-field",level:3},{value:"Turn field into a dropdown",id:"turn-field-into-a-dropdown",level:3},{value:"Save field data to the product data",id:"save-field-data-to-the-product-data",level:3}];function a(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.header,{children:(0,i.jsx)(t.h1,{id:"extending-the-product-form-with-custom-fields",children:"Extending the product form with custom fields"})}),"\n",(0,i.jsx)(t.p,{children:"Aside from extending the product form using generic fields it is also possible to use custom fields. This does require knowledge of JavaScript and React.\nIf you are already familiar with writing blocks for the WordPress site editor this will feel very similar."}),"\n",(0,i.jsx)(t.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,i.jsxs)(t.p,{children:["To get started we would recommend reading through the ",(0,i.jsx)(t.a,{href:"https://developer.wordpress.org/block-editor/getting-started/fundamentals/",children:"fundamentals of block development docs"})," in WordPress. This gives a good overview of working with blocks, the block structure, and the ",(0,i.jsx)(t.a,{href:"https://developer.wordpress.org/block-editor/getting-started/fundamentals/javascript-in-the-block-editor/",children:"JavaScript build process"}),"."]}),"\n",(0,i.jsxs)(t.p,{children:["This tutorial will use vanilla JavaScript to render a new field in the product form for those that already have a plugin and may not have a JavaScript build process set up yet.\nIf you want to create a plugin from scratch with the necessary build tools, we recommend using the ",(0,i.jsx)(t.code,{children:"@wordpress/create-block"})," script. We also have a specific template for the product form: ",(0,i.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/blob/trunk/packages/js/create-product-editor-block/README.md",children:"README"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"creating-a-custom-field",children:"Creating a custom field"}),"\n",(0,i.jsx)(t.h3,{id:"adding-and-registering-our-custom-field",children:"Adding and registering our custom field"}),"\n",(0,i.jsx)(t.p,{children:"Adding and registering our custom field is very similar as creating a brand new block."}),"\n",(0,i.jsxs)(t.p,{children:["Inside a new folder within your plugin, let's create a ",(0,i.jsx)(t.code,{children:"block.json"})," file with the contents below. The only main difference between this ",(0,i.jsx)(t.code,{children:"block.json"})," and a ",(0,i.jsx)(t.code,{children:"block.json"})," for the site editor is that we will set ",(0,i.jsx)(t.code,{children:"supports.inserter"})," to false, so it doesn't show up there. We will also be registering this slightly different."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n\t"$schema": "https://schemas.wp.org/trunk/block.json",\n\t"apiVersion": 3,\n\t"name": "tutorial/new-product-form-field",\n\t"title": "Product form field",\n\t"category": "woocommerce",\n\t"description": "A sample field for the product form",\n\t"keywords": [ "products" ],\n\t"attributes": {},\n\t"supports": {\n\t\t"html": false,\n\t\t"multiple": true,\n\t\t// Setting inserter to false is important so that it doesn\'t show in the site editor.\n\t\t"inserter": false\n\t},\n\t"textdomain": "woocommerce",\n\t"editorScript": "file:./index.js"\n}\n'})}),"\n",(0,i.jsxs)(t.p,{children:["In the same directory, create a ",(0,i.jsx)(t.code,{children:"index.js"})," file, which we can keep simple by just outputting a hello world.\nIn this case the ",(0,i.jsx)(t.code,{children:"edit"})," function is the part that will get rendered in the form. We are wrapping it with the ",(0,i.jsx)(t.code,{children:"createElement"})," function to keep support for React."]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"( function ( wp ) {\n\tvar el = wp.element.createElement;\n\n\twp.blocks.registerBlockType( 'tutorial/new-product-form-field', {\n\t\ttitle: 'Product form field',\n\t\tattributes: {},\n\t\tedit: function () {\n\t\t\treturn el( 'p', {}, 'Hello World (from the editor).' );\n\t\t},\n\t} );\n} )( window.wp );\n"})}),"\n",(0,i.jsx)(t.p,{children:"In React:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"import { registerBlockType } from '@wordpress/blocks';\n\nfunction Edit() {\n\treturn <p>Hello World (from the editor).</p>;\n}\n\nregisterBlockType( 'tutorial/new-product-form-field', {\n\ttitle: 'Product form field',\n\tattributes: {},\n\tedit: Edit,\n} );\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Lastly, in order to make this work the block registration needs to know about the JavaScript dependencies, we can do so by adding a ",(0,i.jsx)(t.code,{children:"index.asset.php"})," file with the below contents:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-php",children:"<?php return array('dependencies' => array('react', 'wc-product-editor', 'wp-blocks' ) );\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now that we have all the for the field we need to register it and add it to the template."}),"\n",(0,i.jsxs)(t.p,{children:["Registering can be done on ",(0,i.jsx)(t.code,{children:"init"})," by calling ",(0,i.jsx)(t.code,{children:"BlockRegistry::get_instance()->register_block_type_from_metadata"})," like so:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-php",children:"use Automattic\\WooCommerce\\Admin\\Features\\ProductBlockEditor\\BlockRegistry;\n\nfunction example_custom_product_form_init() {\n\tif ( isset( $_GET['page'] ) && $_GET['page'] === 'wc-admin' ) {\n        // This points to the directory that contains your block.json.\n\t\tBlockRegistry::get_instance()->register_block_type_from_metadata( __DIR__ . '/js/sample-block' );\n\t}\n}\nadd_action( 'init', 'example_custom_product_form_init' );\n"})}),"\n",(0,i.jsxs)(t.p,{children:["We can add it to the product form by hooking into the ",(0,i.jsx)(t.code,{children:"woocommerce_layout_template_after_instantiation"})," action ( see ",(0,i.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/blob/trunk/docs/product-editor-development/block-template-lifecycle.md#block-addition-and-removal",children:"block addition and removal"})," )."]}),"\n",(0,i.jsxs)(t.p,{children:["What we did was the following ( see ",(0,i.jsx)(t.a,{href:"https://github.com/woocommerce/woocommerce/blob/trunk/plugins/woocommerce/src/Admin/Features/ProductBlockEditor/ProductTemplates/README.md#usage",children:"here"})," for more related functions ):"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Get a group by the ",(0,i.jsx)(t.code,{children:"general"})," id, this is the General tab."]}),"\n",(0,i.jsxs)(t.li,{children:["Create a new section on the general tab called ",(0,i.jsx)(t.code,{children:"Tutorial Section"})]}),"\n",(0,i.jsxs)(t.li,{children:["Add our custom field to the ",(0,i.jsx)(t.code,{children:"Tutorial Section"})]}),"\n"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-php",children:"add_action(\n    'woocommerce_layout_template_after_instantiation',\n    function( $layout_template_id, $layout_template_area, $layout_template ) {\n        $general = $layout_template->get_group_by_id( 'general' );\n\n        if ( $general ) {\n            // Creating a new section, this is optional.\n            $tutorial_section = $general->add_section(\n\t\t\t\tarray(\n\t\t\t\t\t'id'         => 'tutorial-section',\n\t\t\t\t\t'order'      => 15,\n\t\t\t\t\t'attributes' => array(\n\t\t\t\t\t\t'title'       => __( 'Tutorial Section', 'woocommerce' ),\n\t\t\t\t\t\t'description' => __( 'Fields related to the tutorial', 'woocommerce' ),\n\t\t\t\t\t),\n\t\t\t\t)\n\t\t\t);\n            $tutorial_section->add_block(\n                [\n                    'id' \t     => 'example-new-product-form-field',\n                    'blockName'  => 'tutorial/new-product-form-field',\n                    'attributes' => [],\n                ]\n            );\n        }\n    },\n    10,\n    3\n);\n"})}),"\n",(0,i.jsx)(t.h3,{id:"turn-field-into-a-dropdown",children:"Turn field into a dropdown"}),"\n",(0,i.jsxs)(t.p,{children:["We recommend using components from ",(0,i.jsx)(t.code,{children:"@wordpress/components"})," as this will also keep the styling consistent. We will use the ",(0,i.jsx)(t.a,{href:"https://wordpress.github.io/gutenberg/?path=/docs/components-comboboxcontrol--docs",children:"ComboboxControl"})," core component in this field."]}),"\n",(0,i.jsxs)(t.p,{children:["We can add it to our ",(0,i.jsx)(t.code,{children:"edit"})," function pretty easily by making use of ",(0,i.jsx)(t.code,{children:"wp.components"}),". We will also add a constant for the filter options.\n",(0,i.jsx)(t.strong,{children:"Note:"})," I also added the ",(0,i.jsx)(t.code,{children:"blockProps"})," to the top element, we still recommend using this as some of these props are being used in the product form. When we add the block props we need to also let the form know it is an interactive element. We do this by adding at-least one attribute with the ",(0,i.jsx)(t.code,{children:"role"})," set to ",(0,i.jsx)(t.code,{children:"content"}),".\nSo lets add this to our ",(0,i.jsx)(t.code,{children:"index.js"})," attributes:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:' attributes: {\n    "message": {\n        "type": "string",\n        "role": "content",\n        "source": "text",\n        "selector": "div"\n    }\n},\n'})}),"\n",(0,i.jsxs)(t.p,{children:["Dropdown options, these can live outside of the ",(0,i.jsx)(t.code,{children:"edit"})," function:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"const DROPDOWN_OPTIONS = [\n\t{\n\t\tvalue: 'small',\n\t\tlabel: 'Small',\n\t},\n\t{\n\t\tvalue: 'normal',\n\t\tlabel: 'Normal',\n\t},\n\t{\n\t\tvalue: 'large',\n\t\tlabel: 'Large',\n\t},\n];\n"})}),"\n",(0,i.jsxs)(t.p,{children:["The updated ",(0,i.jsx)(t.code,{children:"edit"})," function:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"// edit function.\nfunction ( { attributes } ) {\n    // useState is a React specific function.\n    const [ value, setValue ] = wp.element.useState();\n    const [ filteredOptions, setFilteredOptions ] = wp.element.useState( DROPDOWN_OPTIONS );\n\n    const blockProps = window.wc.blockTemplates.useWooBlockProps( attributes );\n\n\treturn el( 'div', { ...blockProps }, [\n        el( wp.components.ComboboxControl, {\n            label: \"Example dropdown\",\n            value: value,\n            onChange: setValue,\n            options: filteredOptions,\n            onFilterValueChange: function( inputValue ) {\n                setFilteredOptions(\n                    DROPDOWN_OPTIONS.filter( ( option ) =>\n                        option.label\n                        .toLowerCase()\n                        .startsWith( inputValue.toLowerCase() )\n                    )\n                )\n            }\n        } )\n    ] );\n},\n"})}),"\n",(0,i.jsx)(t.p,{children:"In React:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-jsx",children:"import { createElement, useState } from '@wordpress/element';\nimport { ComboboxControl } from '@wordpress/components';\nimport { useWooBlockProps } from '@woocommerce/block-templates';\n\nfunction Edit( { attributes } ) {\n\tconst [ value, setValue ] = useState();\n\tconst [ filteredOptions, setFilteredOptions ] =\n\t\tuseState( DROPDOWN_OPTIONS );\n\n\tconst blockProps = useWooBlockProps( attributes );\n\treturn (\n\t\t<div { ...blockProps }>\n\t\t\t<ComboboxControl\n\t\t\t\tlabel=\"Example dropdown\"\n\t\t\t\tvalue={ value }\n\t\t\t\tonChange={ setValue }\n\t\t\t\toptions={ filteredOptions }\n\t\t\t\tonFilterValueChange={ ( inputValue ) =>\n\t\t\t\t\tsetFilteredOptions(\n\t\t\t\t\t\tDROPDOWN_OPTIONS.filter( ( option ) =>\n\t\t\t\t\t\t\toption.label\n\t\t\t\t\t\t\t\t.toLowerCase()\n\t\t\t\t\t\t\t\t.startsWith( inputValue.toLowerCase() )\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t}\n\t\t\t/>\n\t\t</div>\n\t);\n}\n"})}),"\n",(0,i.jsx)(t.h3,{id:"save-field-data-to-the-product-data",children:"Save field data to the product data"}),"\n",(0,i.jsxs)(t.p,{children:["We can make use of the ",(0,i.jsx)(t.code,{children:"__experimentalUseProductEntityProp"})," for saving the field input to the product.\nThe function does rely on ",(0,i.jsx)(t.code,{children:"postType"}),", we can hardcode this to ",(0,i.jsx)(t.code,{children:"product"}),", but the ",(0,i.jsx)(t.code,{children:"postType"})," is also exposed through a context. We can do so by adding ",(0,i.jsx)(t.code,{children:'"usesContext": [ "postType" ],'})," to the ",(0,i.jsx)(t.code,{children:"block.json"})," and getting it from the ",(0,i.jsx)(t.code,{children:"context"})," passed into the ",(0,i.jsx)(t.code,{children:"edit"})," function props."]}),"\n",(0,i.jsxs)(t.p,{children:["So the top part of the edit function will look like this, where we also replace the ",(0,i.jsx)(t.code,{children:"value, setValue"})," ",(0,i.jsx)(t.code,{children:"useState"})," line:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-javascript",children:"// edit function.\nfunction ( { attributes, context } ) {\n    const [ value, setValue ] = window.wc.productEditor.__experimentalUseProductEntityProp(\n\t\t'meta_data.animal_type',\n\t\t{\n\t\t\tpostType: context.postType,\n\t\t\tfallbackValue: '',\n\t\t}\n\t);\n    // .... Rest of edit function\n"})}),"\n",(0,i.jsx)(t.p,{children:"Now if you select small, medium, or large from the dropdown and save your product, the value should persist correctly."}),"\n",(0,i.jsxs)(t.p,{children:["Note, the above function supports the use of ",(0,i.jsx)(t.code,{children:"meta_data"})," by dot notation, but you can also target other fields like ",(0,i.jsx)(t.code,{children:"regular_price"})," or ",(0,i.jsx)(t.code,{children:"summary"}),"."]})]})}function u(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,t,o)=>{o.d(t,{R:()=>s,x:()=>d});var n=o(6540);const i={},r=n.createContext(i);function s(e){const t=n.useContext(r);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function d(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);