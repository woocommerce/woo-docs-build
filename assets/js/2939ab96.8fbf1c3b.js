"use strict";(self.webpackChunkwoo_docs_migration=self.webpackChunkwoo_docs_migration||[]).push([[3420],{6300:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"extensions/core-concepts/adding-actions-and-filters","title":"How to add actions and filters","description":"Like many WordPress plugins, WooCommerce provides a range of actions and filters through which developers can extend and modify the platform.","source":"@site/../extensions/core-concepts/adding-actions-and-filters.md","sourceDirName":"extensions/core-concepts","slug":"/extensions/core-concepts/adding-actions-and-filters","permalink":"/docs/extensions/core-concepts/adding-actions-and-filters","draft":false,"unlisted":false,"editUrl":"https://github.com/woocommerce/woocommerce/tree/docusaurus-docs-prep/docs/docs/../extensions/core-concepts/adding-actions-and-filters.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"post_title":"How to add actions and filters","sidebar_label":"Actions and filters","sidebar_position":2},"sidebar":"extensionsSidebar","previous":{"title":"Classes","permalink":"/docs/extensions/core-concepts/class-reference"},"next":{"title":"Changelog.txt","permalink":"/docs/extensions/core-concepts/changelog-txt"}}');var i=o(4848),s=o(8453);const r={post_title:"How to add actions and filters",sidebar_label:"Actions and filters",sidebar_position:2},a="How to add actions and filters",l={},c=[{value:"Prefer existing hooks (or other alternatives)",id:"prefer-existing-hooks-or-other-alternatives",level:2},{value:"Adding lifecycle hooks",id:"adding-lifecycle-hooks",level:2},{value:"Escape hooks",id:"escape-hooks",level:2},{value:"Modifying function input and output (global rendering functions)",id:"modifying-function-input-and-output-global-rendering-functions",level:2},{value:"Prefer passing objects over IDs",id:"prefer-passing-objects-over-ids",level:2},{value:"Tying lifecycle hooks to methods of execution",id:"tying-lifecycle-hooks-to-methods-of-execution",level:2},{value:"Using filters as feature flags",id:"using-filters-as-feature-flags",level:2},{value:"Placement of filter hooks",id:"placement-of-filter-hooks",level:2},{value:"Enumeration values inside hook names",id:"enumeration-values-inside-hook-names",level:2},{value:"Summary",id:"summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"how-to-add-actions-and-filters",children:"How to add actions and filters"})}),"\n",(0,i.jsx)(n.p,{children:"Like many WordPress plugins, WooCommerce provides a range of actions and filters through which developers can extend and modify the platform."}),"\n",(0,i.jsx)(n.p,{children:"Often, when writing new code or revising existing code, there is a desire to add new hooks-but this should always be done with thoughtfulness and care. This document aims to provide high-level guidance on the matter."}),"\n",(0,i.jsx)(n.p,{children:"Practices we generally allow, support and encourage include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#prefer-existing-hooks-or-other-alternatives",children:"Using existing hooks (or other alternatives) in preference to adding new hooks"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#adding-lifecycle-hooks",children:"Adding lifecycle hooks"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#escape-hooks",children:"Optional escape hooks"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#modifying-function-input-and-output-global-rendering-functions",children:"Modifying the inputs and outputs of global rendering functions"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#prefer-passing-objects-over-ids",children:"Preferring the passing of objects over IDs"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"On the flip side, there are several practices we discourage:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#tying-lifecycle-hooks-to-methods-of-execution",children:"Tying lifecycle hooks to methods of execution"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#using-filters-as-feature-flags",children:"Using filters as feature flags"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#placement-of-filter-hooks",children:"Placing filter hooks inside templates and data stores"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"#enumeration-values-inside-hook-names",children:"Enumeration values within hook names"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Beyond those items, we generally otherwise adhere to WordPress coding standards. In regards to hooks, that specifically means following the:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://make.wordpress.org/core/handbook/best-practices/inline-documentation-standards/php/#4-hooks-actions-and-filters",children:"Documentation standards for hooks"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://make.wordpress.org/core/handbook/best-practices/coding-standards/php/#interpolation-for-naming-dynamic-hooks",children:"Guidance on Dynamic hook names"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Please note that we provide example code throughout this guide to help illustrate some of the principles. However, to keep things concise, we usually omit unnecessary detail, including doc blocks (in practice, though, hooks should always be accompanied by doc blocks!)."}),"\n",(0,i.jsx)(n.h2,{id:"prefer-existing-hooks-or-other-alternatives",children:"Prefer existing hooks (or other alternatives)"}),"\n",(0,i.jsx)(n.p,{children:"Hooks come with a long-term obligation: the last thing we want is to add a new hook that developers come to depend on, only to strip it away again. However, this can lead to difficulties when the time comes to refactor a piece of code that contains hooks, sometimes delaying meaningful change or limiting how easily we can implement a change without compromising on backward compatibility commitments."}),"\n",(0,i.jsx)(n.p,{children:"For those reasons, we always prefer that-wherever reasonable-an existing hook or alternative approach in preference to adding a new hook."}),"\n",(0,i.jsx)(n.h2,{id:"adding-lifecycle-hooks",children:"Adding lifecycle hooks"}),"\n",(0,i.jsx)(n.p,{children:"Lifecycle hooks can be used to communicate that a lifecycle event is about to start, or that it has concluded. Examples of such events include:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Main product loop"}),"\n",(0,i.jsx)(n.li,{children:"Dispatching emails"}),"\n",(0,i.jsx)(n.li,{children:"Rendering a template"}),"\n",(0,i.jsx)(n.li,{children:"Product or order status changes"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In general, lifecycle hooks:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Come in pairs ('before' and 'after')"}),"\n",(0,i.jsx)(n.li,{children:"Are always actions, never filters"}),"\n",(0,i.jsx)(n.li,{children:"The 'before' hook will generally always provide callbacks with the arguments array, if there is one"}),"\n",(0,i.jsx)(n.li,{children:"The 'after' hook will generally also provide callbacks with the function's return value, if there is one"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Note that lifecycle hooks primarily exist to let other systems observe, rather than to modify the result. Of course, this does not stop the function author from additionally providing a filter hook that serves this function."}),"\n",(0,i.jsx)(n.p,{children:'For example, noting that it is the process of fetching the promotions which we view as the "lifecycle event", and not the function itself:'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"function woocommerce_get_current_promotions( ...$args ) {\n    /* Any initial prep, then first lifecycle hook... */\n    do_action( 'woocommerce_before_get_current_promotions', $args );\n    /* ...Do actual work, then final lifecycle hook... */\n    do_action( 'woocommerce_after_get_current_promotions', $result, $args );\n    /* ...Return the result, optionally via a filter... */\n    return apply_filters( 'woocommerce_get_current_promotions', $result, $args );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"escape-hooks",children:"Escape hooks"}),"\n",(0,i.jsx)(n.p,{children:"In some cases, it may be appropriate to support short-circuiting of functions or methods. This is what we call an escape hook, and can be useful as a means of overriding code when a better way of doing so is not available."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Escape hooks are always filters"}),"\n",(0,i.jsx)(n.li,{children:"They should always supply null as the initial filterable value"}),"\n",(0,i.jsx)(n.li,{children:"If the value is changed to a non-null value, then the function should exit early by returning that new value"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For type safety, care should be taken to ensure that, if a function is short-circuited, the return type matches the function signature and/or return type stated in the function doc block."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"function get_product_metrics( $args ): array {\n    $pre = apply_filters( 'pre_woocommerce_get_product_metrics', null, $args );\n\n    if ( $pre !== null ) {\n        return (array) $pre;\n    }\n\n    /* ...Default logic... */\n    return $metrics;\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"modifying-function-input-and-output-global-rendering-functions",children:"Modifying function input and output (global rendering functions)"}),"\n",(0,i.jsx)(n.p,{children:'In the case of global rendering or formatting functions (so-called "template tags"), where it is not readily possible to implement better alternatives, it is permissible to add filters for both the function arguments and the function\'s return value.'}),"\n",(0,i.jsx)(n.p,{children:"This should be done sparingly, and only where necessary. Remember that while providing opportunities for other components to perform extensive customization, it can potentially derail other components which expect unmodified output."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"function woocommerce_format_sale_price( ...$args ): string {\n    /* Prep to fill in any missing $args values... */\n    $args = (array) apply_filters( 'woocommerce_format_sale_price_args', $args );\n    /* ...Actual work to determine the $price string... */\n    return (string) apply_filters( 'woocommerce_format_sale_price', $price, $args );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"prefer-passing-objects-over-ids",children:"Prefer passing objects over IDs"}),"\n",(0,i.jsx)(n.p,{children:"Some actions or filters provide an object ID (such as a product ID) as their primary value, while others will provide the actual object itself (such as a product object). For consistency, it is preferred that objects be passed."}),"\n",(0,i.jsx)(n.p,{children:"Example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"function get_featured_product_for_current_customer( ) {\n    /* ...Logic to find the featured product for this customer... */\n\n    return apply_filters( \n        'woocommerce_featured_product_for_current_customer', \n        $product, /* WC_Product */\n        $customer \n    );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"tying-lifecycle-hooks-to-methods-of-execution",children:"Tying lifecycle hooks to methods of execution"}),"\n",(0,i.jsx)(n.p,{children:"There can sometimes be multiple paths leading to the same action. For instance, an order can be updated via the REST API, through the admin environment, or on the front end. It may additionally happen via ajax, or via a regular request."}),"\n",(0,i.jsx)(n.p,{children:"It is important however not to tie hooks for high-level processes to specific execution paths. For example, an action that fires when an order is created must not only be fired when this happens in the admin environment via an ajax request."}),"\n",(0,i.jsx)(n.p,{children:"Instead, prefer a more generic hook that passes context about the method of execution to the callback."}),"\n",(0,i.jsx)(n.p,{children:"Example of what we wish to avoid:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"/**\n * Pretend this function is only called following an ajax request\n * (perhaps it is itself hooked in using a `wp_ajax_*` action).\n */\nfunction on_ajax_order_creation() {\n    /* Avoid this! */\n    do_action( 'woocommerce_on_order_creation' );\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"using-filters-as-feature-flags",children:"Using filters as feature flags"}),"\n",(0,i.jsx)(n.p,{children:"It is sometimes tempting to use a filter as a sort of feature flag, that enables or disables a piece of functionality. This should be avoided! Prefer using an option:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Options persist in the database."}),"\n",(0,i.jsx)(n.li,{children:"Options are already filterable (ideal for a temporary override)."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Example of what we wish to avoid:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"/* Avoid this */\n$super_products_enabled = (bool) apply_filters( 'woocommerce_super_products_are_enabled', true );\n\n/* Prefer this */\n$super_products_enabled = get_option( 'woocommerce_super_products_are_enabled', 'no' ) === 'yes';\n"})}),"\n",(0,i.jsx)(n.h2,{id:"placement-of-filter-hooks",children:"Placement of filter hooks"}),"\n",(0,i.jsx)(n.p,{children:"Filters should not be placed inside templates-only actions. If it is important that a value used within a template be filterable, then the relevant logic should be moved to whichever function or method decides to load the template-the result being passed in as a template variable."}),"\n",(0,i.jsx)(n.p,{children:"It is also preferred that filter hooks not be placed inside data-store classes, as this can reduce the integrity of those components: since, by design, they are replaceable by custom implementations-the risk of accidentally breaking those custom stores is higher."}),"\n",(0,i.jsx)(n.h2,{id:"enumeration-values-inside-hook-names",children:"Enumeration values inside hook names"}),"\n",(0,i.jsx)(n.p,{children:"Though there is a case for dynamic hook names (where part of the hook name is created using a variable), a good rule of thumb is to avoid this if the variable contains what might be considered an enumeration value."}),"\n",(0,i.jsx)(n.p,{children:"This might for instance include a case where an error code forms part of the hook name."}),"\n",(0,i.jsx)(n.p,{children:"Example (of what we wish to avoid):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-php",children:"if ( is_wp_error( $result ) ) {\n    /* Avoid this */\n    $error_code = $result->get_error_code();\n    do_action( \"woocommerce_foo_bar_{$error_code}_problem\", $intermediate_result );\n    \n    /* Prefer this */\n    do_action( 'woocommerce_foo_bar_problem', $result );\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The primary reason for avoiding this is that the more values there are in the enumeration set, the more filters developers have to include in their code."}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"This document is a high-level guide to the inclusion and placement of hooks, not an exhaustive list. There will occasionally be exceptions, and there may be good rules and methodologies we are missing: if you have suggestions or ideas for improvement, please reach out!"})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>r,x:()=>a});var t=o(6540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);